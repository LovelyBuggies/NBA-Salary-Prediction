# ç”¨Microsoft Azure Notebooké¢„æµ‹NBAçƒå‘˜çš„è–ªæ°´


## èƒŒæ™¯ä»‹ç»

> æ®è‘—åNBAè®°è€…Chris HaynesæŠ¥é“ï¼Œåœ¨ä»Šå¹´ç»“æŸå­£åèµ›ä¹‹æ—…åï¼Œå¼€æ‹“è€…å’Œåˆ©æ‹‰å¾·é¢„è®¡ä¼šåœ¨ä»Šå¹´å¤å¤©è¾¾æˆ4å¹´1.91äº¿ç¾å…ƒç»­çº¦åˆåŒã€‚ğŸ’µ

![](http://ww1.sinaimg.cn/bmiddle/006tNc79gy1g5hkvrqx5wj30om0jo76k.jpg)

è¿™ä»½è¶…çº§é¡¶è–ªåˆåŒçš„è–ªæ°´è¾¾åˆ°äº†ä»¤äººå’‹èˆŒçš„4260ä¸‡ç¾å…ƒã€4600ä¸‡ç¾å…ƒã€4940ä¸‡ç¾å…ƒå’Œ5280ä¸‡ç¾å…ƒã€‚ä»0.7ç§’ç»æ€ç«ç®­ğŸš€åˆ°ç‹¬å®ˆæ’•è£‚ä¹‹åŸï¼›ä»è¢«äººè´¨ç–‘æ— ç¼˜å…¨æ˜æ˜Ÿåˆ°å„è·¯æ‰“è„¸è¯æ˜å®åŠ›è¿›å…¥è¥¿å†³ï¼Œåˆ©æŒ‡å¯¼è¿™ä»½å¤§åˆåŒå¯è°“æ˜¯è´§çœŸä»·å®ã€‚

![](http://ww3.sinaimg.cn/bmiddle/006tNc79gy1g5hjx4hryzj30gs09m74x.jpg)

ä½†è¿˜æ˜¯å‡ºç°äº†å¾ˆå¤šè´¨ç–‘å£°ï¼Œå¾ˆå¤šäººè®¤ä¸ºè¿™ä»½åˆåŒå®åœ¨æ˜¯å¤ªå¤§äº†ã€‚æ¯•ç«Ÿï¼Œé¥æƒ³20å¹´å‰ï¼Œè”ç›Ÿçš„å·¥èµ„å¸½ä¹Ÿå°±åªæœ‰2000å¤šä¸‡ï¼Œå¼ºå¦‚ä¹”è€å¸®ä¸»æœ€é«˜æ‰æ‹¿è¿‡3000ä¸‡å¹´è–ªã€‚è¿™è¿˜æ˜¯åœ¨è”ç›Ÿä¸ºäº†æ”¶è§†ç‡ç»™äº†ä¹”ä¸¹ç‰¹ä¾‹ï¼ŒåŒæ—¶ä»£çš„å·¨æ˜Ÿå¡å°”é©¬é¾™çš„å¹´è–ªæ›´æ˜¯åªæœ‰500ä¸‡ï¼Œç›´åˆ°è¿›å…¥21ä¸–çºªåé©¬é¾™çš„å¹´è–ªæ‰è¾¾åˆ°äº†1500ä¸‡ã€‚

![](http://ww3.sinaimg.cn/bmiddle/006tNc79gy1g5hjw2xfcyj30qe0gwq6h.jpg)

è€æ²¹æ¡ä»¬æ„Ÿæ…¨ç”Ÿä¸é€¢æ—¶ï½çœ‹ç€å¦‚ä»Šå°é²œè‚‰ä»¬æ¼«å¤©çš„å¤§åˆåŒï¼Œå¤§æ¦‚æ˜¯å“­æ™•åœ¨å•æ‰€äº†å§ï¼ğŸ˜¥

![](http://ww4.sinaimg.cn/bmiddle/006tNc79gy1g5gw9x4it9j30g20930t9.jpg)

å³ä½¿æ˜¯åœ¨åŒä¸€å¹´ï¼ŒNBAçƒå‘˜çš„è´«å¯Œå·®è·ä¹Ÿæ˜¯ååˆ†æ‚¬æ®Šçš„ã€‚æ™®éçš„åŸåˆ™ä¾¿æ˜¯â€œèƒ½è€…å¤šåŠ³ï¼Œå¤šåŠ³å¤šå¾—â€ã€‚ä½†æ­£æ‰€è°“æ²¡æœ‰å¯¹æ¯”å°±æ²¡æœ‰ä¼¤å®³ï¼šå¾ˆå¤šçƒæ˜Ÿï¼Œæ‹¿ç€ç«¥å·¥åˆåŒåœ¨çƒé˜Ÿå½“çˆ¹åˆå½“å¦ˆï¼›è€Œä¸€äº›çƒå‘˜ï¼Œé ç€æ¯’è¯åˆåŒï¼Œæ—¥å¸¸å› ä¼¤ä¼‘æˆ˜ï¼Œå´ä¾ç„¶èƒ½åƒé¦™å–è¾£ã€‚

![](http://ww3.sinaimg.cn/bmiddle/006tNc79ly1g5gwvqid95j30x00hq0y5.jpg)

è–ªèµ„åˆ†é…åœ¨NBAå¯æ˜¯å…³ä¹çƒé˜Ÿå‘å±•çš„å¤§äº‹æƒ…ï¼šé’±å°‘äº†ï¼Œç•™ä¸ä½è¶…çº§çƒæ˜Ÿï¼›ä¸€æ‹›ä¸æ…ï¼Œåˆæœ‰å¯èƒ½äº¤ç€å¥¢ä¾ˆç¨ç­‰ç€æ¥å¹´çš„ä¹é€ç§€ã€‚æœ‰äº›è€æ¿çœ‹èµ°äº†çœ¼ï¼Œä¸€æ¿€åŠ¨ç›´æ¥æ–­é€äº†çƒé˜Ÿå‡ å¹´çš„æœªæ¥ã€‚æ„Ÿæ…¨å‘½è¿ä¸å…¬çš„åŒæ—¶ï¼Œèµ¶ç´§åŠNBAçƒé˜Ÿè€æ¿ä¸€å¥ï¼šâ€œå°è€å¼Ÿå„¿ï¼Œä½ å¯é•¿ç‚¹å¿ƒå§ï¼â€

![](http://ww4.sinaimg.cn/bmiddle/006tNc79ly1g5gx4lbkpkj30ei09ejrs.jpg)

é‚£ä¹ˆNBAç©¶ç«Ÿæ˜¯æ€æ ·"**æŒ‰åŠ³åˆ†é…**"çš„å‘¢ï¼Ÿåœ¨è¿™ä¸ªå®éªŒä¸­ï¼Œæˆ‘ä»¬å°±ç”¨Azureçš„Notebookå·¥å…·ğŸ”§ï¼Œæ¥å¸®å¸®è¿™ç¾¤è€æ¿ä»¬æŠŠæŠŠå…³ï¼

![](http://ww2.sinaimg.cn/bmiddle/006tNc79gy1g5humv8y4tj30im0andfy.jpg)

---

## é¡¹ç›®ç®€ä»‹

ä¸ºäº†å¸®åŠ©çƒé˜Ÿè€æ¿ç»¼åˆè¯„ä¼°çƒå‘˜å®åŠ›ï¼Œä»¥åŠå¸®åŠ©NBAçƒå‘˜åˆç†åœ°å®šä½è‡ªå·±çš„ä»·å€¼ï¼Œæ­¤å®éªŒç”¨[Microsoft Azure Notebook](https://notebooks.azure.com/)æ­å»ºäº†ä¸€äº›å›å½’æ¨¡å‹ï¼Œä¸ºäº†åˆæ­¥é¢„æµ‹NBAçƒå‘˜èƒ½å¤Ÿè·å¾—çš„è–ªæ°´ã€‚æœ¬å®éªŒä»[ğŸ€Basketball Reference](https://www.basketball-reference.com/)çˆ¬å–äº†2010åˆ°2019å¹´çš„çƒå‘˜åŸºæœ¬æ•°æ®å’Œè–ªèµ„æƒ…å†µï¼Œç»è¿‡äº†æ•°æ®é¢„å¤„ç†ä¹‹åç”¨sklearnä¸­å¤šç§å›å½’æ–¹æ³•è¿›è¡Œé¢„æµ‹ã€‚æ•°æ®è¡¨æ˜ï¼Œè¿™ç§é¢„æµ‹è™½ç„¶æ˜¯æœ‰æ•ˆçš„ ï¼Œä½†æ˜¯åœ¨å˜å¹»è«æµ‹ã€ç¬æ¯ä¸‡å˜çš„NBAçƒå‘˜å¸‚åœºä¸­ï¼Œä»…ä»…ä¾èµ–è¿™ç§æ–¹æ³•è¿›è¡Œé¢„æµ‹å¯¹è€æ¿ä»¬æ¥è¯´å¯èƒ½å¹¶ä¸å¯é ã€‚ç‚¹å‡»[**è¿™é‡Œ**](https://gallery.azure.ai/Collection/NBA-salary-prediction)æŸ¥çœ‹é¡¹ç›®çš„AI Galleryåœ°å€ï¼Œæ‚¨ä¹Ÿå¯ä»¥ä»[**è¿™é‡Œ**](https://notebooks.azure.com/ninomyemail/projects/nba-salary-prediction)æŸ¥çœ‹Azure Notebooké¡¹ç›®åŸå§‹åœ°å€è·å–æºä»£ç ã€‚

![](http://ww4.sinaimg.cn/bmiddle/006tNc79gy1g5huoqkd6yj30f108cmx9.jpg)

---

## ä½¿ç”¨å·¥å…·

è¿™ä¸ªå®éªŒæ˜¯åœ¨[Microsoft Azure Notebook](https://notebooks.azure.com/)å¹³å°ä¸Šæ­å»ºäº†NBAçƒå‘˜æ”¶å…¥çš„é¢„æµ‹æ¨¡å‹ã€‚é‚£ä¹ˆä¸ºä»€ä¹ˆè¦ç”¨è¿™ä¸ªå¹³å°å‘¢ï¼Ÿ[Azure Machine Learning Studio](https://studio.azureml.net/)ä¸æ‰æ˜¯å…¬è®¤çš„[Azure](https://azure.microsoft.com/en-us/)ä¸»æµæœºå™¨å­¦ä¹ å¼€å‘å¹³å°ä¹ˆï¼Ÿ

å› ä¸º[Azure Machine Learning Studio](https://studio.azureml.net/)å®åœ¨æ˜¯å¤ªæ…¢äº†ï¼Œå¿’æ»¡è¾½......å¯èƒ½æ˜¯å› ä¸ºåœ°åŒºçš„ç½‘ç»œé—®é¢˜ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯Studioé›†æˆäº†å¤ªå¤šadvancedçš„åŠŸèƒ½ï¼Œæœ‰æ—¶å€™åˆ·æ–°ä¸ªç½‘é¡µä¹Ÿéœ€è¦å¾ˆä¹…ğŸ¤¬ã€‚å¾ˆä¸è½»é‡çº§ã€å¾ˆä¸å‹å¥½ã€‚ä¸¾ä¸€ä¸ªæ —å­ğŸŒ°ï¼š

![](http://ww3.sinaimg.cn/large/006tNc79gy1g5hlkq2kufg30py0fm7wk.gif)

å› ä¸ºæˆ‘ä¸éœ€è¦ç”¨é‚£ä¹ˆå¤šåŠŸèƒ½ï¼Œæœ‰ä¸ªnotebookå°±èƒ½è‹Ÿå»¶æ®‹å–˜äº†ï¼Œæ‰€ä»¥æˆ‘å¹²è„†å¤§å¸å…«å—ï¼Œåªç”¨äº†[Microsoft Azure Notebook](https://notebooks.azure.com/)å¹³å°ã€‚

æ‰“å¼€[Azure Notebook](https://notebooks.azure.com/)ï¼Œæ‚¨ä¼šçœ‹åˆ°è¿™ä¸ªç•Œé¢ï¼Œç„¶å[log/sign in](https://notebooks.azure.com/account/signin#)å°±å¥½äº†ï¼ˆ*æ¨èç”¨GitHubç™»é™†ï¼Œå› ä¸ºè¿™æ ·å¯ä»¥ç›´æ¥poståˆ°æ‚¨çš„repoä¸­*ï¼‰ã€‚

![](http://ww3.sinaimg.cn/bmiddle/006tNc79gy1g5jxkq6ta3j31770u0wlw.jpg)

è°ç”¨è°çŸ¥é“ï¼Œç”¨äº†éƒ½è¯´å¥½ï¼Azureè¿™ä¸ªäº§å“çš„ä¼˜åŠ¿æ˜¯æ˜¾è€Œæ˜“è§çš„ï¼Œé‚£å°±æ˜¯â€”â€”**ç®€å•**ï¼è¿›å…¥æ‚¨åˆ›å»ºçš„è´¦å·ï¼Œæ‚¨å¯ä»¥çœ‹åˆ°å¦‚ä¸‹é¡µé¢ã€‚æ˜¯ä¸æ˜¯å¾ˆç†Ÿæ‚‰ï¼Ÿæ˜¯çš„ï¼Œç®€ç›´å°±æ˜¯ä¸€ä¸ªæ”¹ç‰ˆçš„â€œNoteHubâ€å•Šï¼è¿™ä¸ªå¹³å°ææ˜“ä¸Šæ‰‹ï¼ŒåŸºæœ¬ä¸Šä¼šç”¨[GitHub](https://github.com/)å’Œ[Jupyter Notebook](https://jupyter.org/)éƒ½èƒ½ç›´æ¥ä½¿ç”¨ï¼Œè€Œä¸”é¡¹ç›®å¯ä»¥ç›´æ¥ä¼ åˆ°æ‚¨çš„[GitHub repo](https://github.com/)ä¸­ï¼Œç¬¦åˆå¾ˆå¤šç¨‹åºå‘˜çš„å¼€å‘ä¹ æƒ¯ã€‚

![](http://ww1.sinaimg.cn/bmiddle/006tNc79gy1g5hllmvdosj31k40u0103.jpg)

æ­¤å¤–ï¼Œ[Azure Notebook](https://notebooks.azure.com/)éƒ½å·²ç»ä¸ºæ‚¨é…ç½®å¥½äº†å„ç§kernelsï¼Œæ‚¨ç”šè‡³å¯ä»¥éšæ„åˆ‡æ¢åˆ°Rè¯­è¨€çš„kernelï¼Œç®€ç›´ä¸è¦å¤ªå¥½ã€‚å› ä¸ºåœ¨è‡ªå·±æœ¬åœ°çš„notebookä¸Šé…ç½®ç¯å¢ƒå¯èƒ½éœ€è¦åŠ¨åˆ°åº•ä¸‹çš„conda enviromentï¼Œæœ‰æ—¶å€™ç¯å¢ƒä¸€å¤šäº†å°±å®Œå…¨å¯¹ä¸ä¸Šå·äº†ã€‚è€Œä¸”ä¼—æ‰€å‘¨çŸ¥ï¼Œæ‹¥æœ‰å¤ªå¤šcondaç¯å¢ƒå¾ˆå®¹æ˜“é€ æˆèµ„æºæµªè´¹ã€‚æ›´å‰å®³çš„æ˜¯ï¼Œ[Azure Notebook](https://notebooks.azure.com/)ç«Ÿç„¶é›†æˆäº†Webå¼€å‘åŠŸèƒ½ï¼Œå¯ä»¥å»ºç«‹ç›¸å…³çš„WebæœåŠ¡ã€‚(*ä¸è¿‡æˆ‘åœ¨è¿™ä¸ªå®éªŒä¸­æš‚æ—¶è¿˜æ²¡æœ‰ç”¨åˆ°ï¼Œä»å®˜æ–¹[tutorial](https://docs.microsoft.com/en-us/azure/notebooks/tutorial-create-run-jupyter-notebook)ä¸Šåº”è¯¥å¯ä»¥æ‰¾åˆ°å»ºç«‹WebæœåŠ¡çš„æ–¹æ³•ã€‚*)

æœ€é‡è¦çš„æ˜¯ï¼Œå½“ç‚¹äº†RunæŒ‰é’®ä¹‹åï¼Œç•Œé¢å°±å˜å¾—è·Ÿæœ¬åœ°notebookä¸€æ¯›ä¸€æ ·äº†ã€‚è¿™ä¸ªä¼˜åŠ¿å¯¹æˆ‘è¿™ç§é…ç½®ç¯å¢ƒæ ‘æ‡’æ¥è¯´æ˜¯æåº¦å‹å¥½çš„ï¼Œå› ä¸ºæˆ‘å¯ä»¥èŠ‚çº¦å¾ˆå¤šæ—¶é—´âŒšï¸ï¼ŒæŠŠæ›´å¤šç²¾åŠ›æ”¾åˆ°è®¾è®¡å®éªŒğŸ§ªä¸Šäº†ï¼

---

## æ•°æ®é¢„å¤„ç†

å¯é çš„å›å½’ç¦»ä¸å¼€æ¸…æ´çš„æ•°æ®ã€‚

![](http://ww4.sinaimg.cn/bmiddle/006tNc79gy1g5hkupesegj31820isq8e.jpg)

åœ¨çˆ¬å–çš„æ•°æ®é›†ä¸­æœ‰å¾ˆå¤šå™ªéŸ³ï¼šæœ‰äº›é¥®æ°´æœºçƒå‘˜å› ä¸ºæ²¡å¾—åˆ°æœºä¼šä¸Šåœºï¼Œç»Ÿè®¡æ•°æ®æœ‰ç¼ºå¤±é¡¹ï¼›æœ‰çš„çƒå‘˜åœ¨åŒä¸€å¹´æ¢è¿‡çƒé˜Ÿï¼Œæµªè¿¹å¤šæ”¯çƒé˜Ÿæ•ˆåŠ›ï¼›å³ä½¿æ˜¯åœ¨ä¸€ä¸ªèµ›å­£åœ¨åŒä¸€æ”¯çƒé˜Ÿæ•ˆåŠ›ï¼Œä¹Ÿä¼šå‡ºç°é‡å¤æ•°æ®çš„æƒ…å†µã€‚ä¸ºäº†å»ºç«‹å¯ç”¨çš„ã€è‰¯å¥½çš„å›å½’æ¨¡å‹ï¼Œæˆ‘ä»¬å¿…é¡»å‰”é™¤æ‰ä¸€äº›å†—ä½™æ•°æ®ã€‚

é™¤æ­¤ä¹‹å¤–ï¼ŒNBAçƒå‘˜çš„èµ›å­£ç»Ÿè®¡å’Œè–ªæ°´å¹¶ä¸åœ¨åŒä¸€ä¸ªæ•°æ®é›†ä¸­ï¼šçƒå‘˜æ•°æ®æ”¾åˆ°äº†[league](https://www.basketball-reference.com/leagues/)ç›®å½•ä¸‹ï¼Œè€Œçƒå‘˜è–ªæ°´æ”¾åˆ°äº†[contract](https://www.basketball-reference.com/contracts/players.html)ç›®å½•ä¸‹ã€‚ä¸ºäº†å°†çƒå‘˜è¡¨ç°ä¸çƒå‘˜è–ªæ°´è”ç³»èµ·æ¥ï¼Œæˆ‘ä»¬è¿˜è¦å°½é‡å°†ä¸¤è€…å°è£…åˆ°ä¸€èµ·ï¼Œä»¥ä¾¿åç»­å¤„ç†ã€‚ä¸‹é¢å°±è¯¦ç»†åœ°é˜è¿°ä¸€ä¸‹æˆ‘æ˜¯æ€æ ·é¢„å¤„ç†çš„ã€‚

éƒ½9012å¹´äº†ï¼Œæ‚¨é¦–å…ˆéœ€è¦æ›´æ–°ä¸€ä¸‹æ‚¨çš„pipï¼Œç¡®ä¿æ‚¨çš„å·¥å…·åŒ…æ²¡æœ‰out-of-dateã€‚


```python
import sys
!{sys.executable} -m pip install --upgrade pip
```


ç„¶åå¯¼å…¥ç›¸å…³çš„è½®å­ã€‚


```python
import requests
from bs4 import BeautifulSoup
import pprint as p
import pandas as pd
import numpy as np
import re
import os
import seaborn as sns
import matplotlib.pyplot as plt

pd.options.display.max_columns = None
```

ç„¶åæˆ‘ä»¬éœ€è¦å»ºç«‹ä¸€ä¸ªdata frameæ¥å­˜å‚¨å’Œæ“ä½œplayersçš„è¡¨ç°ã€‚è¿™ä¸ªdata frameè¯»å–äº†2010åˆ°2019å¹´æ¯å¹´çš„çƒå‘˜æ•°æ®ï¼Œå¹¶åæ¥å°è£…åˆ°ä¸€ä¸ªpickleä¸­ã€‚


```python

list_ = ['rank', 'player', 'pos', 'age', 'team_id', 'games', 'games_started', 'min_per_game', 'field_goals', \
         'field_goals_attempts', 'field_goals_pct', '3points', '3points_attempts', '3points_pct', '2points', \
         '2points_attempts', '2points_pct', 'efg_pct', 'free_throws', 'free_throws_attempts', 'free_throws_pct', \
         'orb', 'drb', 'trb', 'assists', 'steals', 'blocks', 'turnovers', 'personal_fouls', 'points_per_game', 'year']
player_df_final = pd.DataFrame(columns=list_)

player_df_final
```

![](http://ww3.sinaimg.cn/large/006tNc79gy1g5k0fs7oz4g30s000s4hy.gif)

`get_stats`æ˜¯å°†çˆ¬å–æ•°æ®è½¬åŒ–åˆ°æˆ‘ä»¬data frameçš„å‡½æ•°ï¼Œçˆ¬å–çš„statsåŒ…æ‹¬ï¼š`rank`ï¼Œ`player`ï¼Œ`position`ï¼Œ`age`ï¼Œ`team`ï¼Œ`start games`ï¼Œ`field goals`ï¼Œ`field attempts`ï¼Œ`field precision`ï¼Œ`3-points`ï¼Œ`3-points attemps`ï¼Œ`3-points precision`ï¼Œ`2-points`ï¼Œ`2-points attemps`ï¼Œ`2-points precision`ï¼Œ`free-throws`ï¼Œ`free-throws attemps`ï¼Œ`free-throws precision`ï¼Œ`rebounds`ï¼Œ`assists`ï¼Œ`steals`ï¼Œ`blocks`ï¼Œ`turnovers`ï¼Œ`fouls`ä»¥åŠæœ€é‡è¦çš„`points per game`ã€‚


```python
def get_stats(tbody):
    player_dict = {'rank':[],'player':[], 'pos':[], 'age':[], 'team_id':[], 'games':[], 'games_started':[], 
               'min_per_game':[], 'field_goals':[], 'field_goals_attempts':[], 'field_goals_pct':[]
              ,'3points':[], '3points_attempts':[], '3points_pct':[],
              '2points':[], '2points_attempts':[], '2points_pct':[], 'efg_pct':[],
              'free_throws':[], 'free_throws_attempts':[], 'free_throws_pct':[],
              'orb':[], 'drb':[], 'trb':[],
              'assists':[], 'steals':[], 'blocks':[], 'turnovers':[], 'personal_fouls':[], 'points_per_game':[] }

    for test in tbody:
        try:

            player_dict['rank'].append(int(test.find('th', {'data-stat':'ranker'}).get_text()))
            player_dict['player'].append(test.find('td', {'data-stat':'player'}).get_text())
            player_dict['pos'].append(test.find('td', {'data-stat':'pos'}).get_text())
            player_dict['age'].append(test.find('td', {'data-stat':'age'}).get_text())
            player_dict['team_id'].append(test.find('td', {'data-stat':'team_id'}).get_text())
            player_dict['games'].append(test.find('td', {'data-stat':'g'}).get_text())
            player_dict['games_started'].append(test.find('td', {'data-stat':'gs'}).get_text())
            player_dict['min_per_game'].append(test.find('td', {'data-stat':'mp_per_g'}).get_text())
            player_dict['field_goals'].append(test.find('td', {'data-stat':'fg_per_g'}).get_text())
            player_dict['field_goals_attempts'].append(test.find('td', {'data-stat':'fga_per_g'}).get_text())
            player_dict['field_goals_pct'].append(test.find('td', {'data-stat':'fg_pct'}).get_text())
            player_dict['3points'].append(test.find('td', {'data-stat':'fg3_per_g'}).get_text())
            player_dict['3points_attempts'].append(test.find('td', {'data-stat':'fg3a_per_g'}).get_text())
            player_dict['3points_pct'].append(test.find('td', {'data-stat':'fg3_pct'}).get_text())
            player_dict['2points'].append(test.find('td', {'data-stat':'fg2_per_g'}).get_text())
            player_dict['2points_attempts'].append(test.find('td', {'data-stat':'fg2a_per_g'}).get_text())
            player_dict['2points_pct'].append(test.find('td', {'data-stat':'fg2_pct'}).get_text())
            player_dict['efg_pct'].append(test.find('td', {'data-stat':'efg_pct'}).get_text())
            player_dict['free_throws'].append(test.find('td', {'data-stat':'ft_per_g'}).get_text())
            player_dict['free_throws_attempts'].append(test.find('td', {'data-stat':'fta_per_g'}).get_text())
            player_dict['free_throws_pct'].append(test.find('td', {'data-stat':'ft_pct'}).get_text())
            player_dict['orb'].append(test.find('td', {'data-stat':'orb_per_g'}).get_text())
            player_dict['drb'].append(test.find('td', {'data-stat':'drb_per_g'}).get_text())
            player_dict['trb'].append(test.find('td', {'data-stat':'trb_per_g'}).get_text())
            player_dict['assists'].append(test.find('td', {'data-stat':'ast_per_g'}).get_text())
            player_dict['steals'].append(test.find('td', {'data-stat':'stl_per_g'}).get_text())
            player_dict['blocks'].append(test.find('td', {'data-stat':'blk_per_g'}).get_text())
            player_dict['turnovers'].append(test.find('td', {'data-stat':'tov_per_g'}).get_text())
            player_dict['personal_fouls'].append(test.find('td', {'data-stat':'pf_per_g'}).get_text())
            player_dict['points_per_game'].append(test.find('td', {'data-stat':'pts_per_g'}).get_text())

        except:
            continue


    return player_dict
```

ä¸‹é¢æˆ‘ä»¬å°±å¯ä»¥çˆ¬æ•°æ®äº†ğŸ•·ï¸ã€‚çˆ¬å¥½çš„æ•°æ®è¢«å°è£…åˆ°äº†`player_stats_total.pkl`åŒ…ä¸­ã€‚


```python
if os.path.exists('./pkl/player_stats_total.pkl') == False:
    for i in range(2010,2020):
        url = (f"https://www.basketball-reference.com/leagues/NBA_{i}_per_game.html")
        print('Scrype data from: ',url)
        response = requests.get(url)  
        html_soup = BeautifulSoup(response.content,"lxml")
        table = html_soup.find('table', {'id':'per_game_stats'})
        tbody = table.find('tbody').find_all('tr')
        player_dict = get_stats(tbody)
        player_df = pd.DataFrame(player_dict)
        player_df['year'] = i
        player_df_final = player_df_final.append(player_df, ignore_index=True)
        player_df_final.to_pickle('./pkl/player_stats_total.pkl')

    
player_df_final = pd.read_pickle('./pkl/player_stats_total.pkl')
```

çˆ¬å¥½äº†çƒå‘˜çš„è¡¨ç°æ•°æ®ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦å°†salaryè€ƒè™‘è¿›å»ã€‚æˆ‘ä»¬å¼•ç”¨äº†`nba_salaries_1990_to_2018.csv`ï¼Œå¯¹17-18èµ›å­£çš„çƒå‘˜è¿›è¡Œè–ªæ°´é¢„æµ‹ã€‚çœ‹ä¸€ä¸‹é‡Œé¢çš„salaryæ•°æ®é•¿ä»€ä¹ˆæ ·ã€‚


```python
salary_all_year = pd.read_csv('./csv/nba_salaries_1990_to_2018.csv')
salary_2017 = salary_all_year.query('season_start==2017')
salary_2017.head()
```

![](http://ww1.sinaimg.cn/bmiddle/006tNc79gy1g5k0ri64u6j30su09utaj.jpg)

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é¢„æµ‹äº†latestçš„2017å¹´NBAçƒå‘˜è–ªèµ„æ•°æ®ï¼Œæˆ‘ä»¬ç”¨`query`ç­›é€‰å‡º2017å¹´çš„è–ªæ°´æ•°æ®ã€‚


```python
player_stat_2017 = player_df_final.query('year==2017')
player_stat_2017.head()
```

![](http://ww2.sinaimg.cn/large/006tNc79gy1g5k0zinwqrg30s606eayn.gif)

æ¥ä¸‹æ¥éœ€è¦å¯¹æ•°æ®è¿›è¡Œ`merge`æ¥è®©ä¸¤ä¸ªæ•°æ®é›†åˆå¹¶ã€‚æˆ‘ä»¬å…ˆæŠŠçƒå‘˜åå­—æ¢æˆå°å†™ï¼Œè¿™æ ·ä¸¤ä¸ªæ•°æ®é›†ä¸­çš„æ•°æ®é¡¹æ‰å¯ä»¥ç»Ÿä¸€åœ°ç”¨çƒå‘˜åå­—ä½œä¸ºkeyå€¼ã€‚âš ï¸æ³¨æ„ï¼Œè¿™é‡Œä¸èƒ½åˆå¹¶ä¸¤æ¬¡ï¼ˆ*åœ¨notebookä¸Šè·‘ä¸¤æ¬¡*ï¼‰ï¼Œè¿™æ ·ä¼šå‡ºç°å¤šä½™çš„åˆ—ã€‚`merge`ä¹‹åæœ‰å¾ˆå¤šå†—ä½™æ•°æ®ï¼ˆæ¯”å¦‚Acyé‚£ä¸€å¹´å°±è¾—è½¬å¤šæ”¯é˜Ÿä¼ï¼‰ï¼Œdata frameå˜æˆè¿™æ ·äº†ã€‚


```python
player_stat_2017['player'] = player_stat_2017['player'].str.replace(r'[^\w\s]', '').str.lower()
salary_2017['player'] = salary_2017['player'].str.replace(r'[^\w\s]', '').str.lower()

# note that merge can only operate once
player_stat_2017 = player_stat_2017.merge(salary_2017[['player', 'team', 'salary', ]], how = 'left', \
                                          left_on = 'player', right_on = 'player')
player_stat_2017.head()
```

![](http://ww4.sinaimg.cn/large/006tNc79gy1g5k10xkj94g30s606e4qp.gif)

æ•°æ®é›†ä¸­æœ‰äº›è¡¨é¡¹ä¸ºnullï¼Œæˆ‘ä»¬å‰”é™¤äº†è¿™äº›è¡Œã€‚æ‰€æœ‰çš„çƒå‘˜statséƒ½`non-null`äº†ï¼ğŸ˜Š


```python
player_stat_2017 = player_stat_2017[player_stat_2017['salary'].notnull()]
player_stat_2017.info()
```

![](http://ww1.sinaimg.cn/bmiddle/006tNc79gy1g5k12bbf5wj30u00ztdni.jpg)


æœ‰äº›çƒå‘˜åœ¨ä¸€ä¸ªèµ›å­£è¾—è½¬å¤šæ”¯çƒé˜Ÿï¼Œè¿™å°±ç»™æˆ‘ä»¬çš„æ•°æ®å¤„ç†å¸¦æ¥å¾ˆå¤§é—®é¢˜ã€‚ä¸ºäº†ç®€åŒ–åç»­æ“ä½œï¼Œæˆ‘ä»¬é€‰æ‹©äº†ä»–ä»¬å½“èµ›å­£å‡ºå¸­æ¯”èµ›æœ€å¤šçš„çƒé˜Ÿä½œä¸ºåŸºå‡†ã€‚

![](http://ww2.sinaimg.cn/bmiddle/006tNc79gy1g5hnif9t72j30si0fkn0y.jpg)

æˆ‘ä»¬å°†playerå’Œgamesè¿›è¡Œå‡åºæ’åˆ—ï¼Œç„¶åç”¨`drop_duplicates`æ–¹æ³•æ¶ˆé™¤å®ƒä»¬ã€‚è¿™ä¸ªåšæ³•å¯è°“ä¸€çŸ³äºŒé¸Ÿï¼Œå³æ’é™¤äº†é‡å¤çš„æ•°æ®ï¼ŒåŒæ—¶ä¹Ÿè§£å†³äº†ä¸€äººå¤šé˜Ÿçš„é—®é¢˜ã€‚

å†æ¥çœ‹ä¸€ä¸‹Acyï¼Œåªå‰©ä¸‹ä¸€æ¡è®°å½•äº†â€”â€”å½“å¹´æ¯”èµ›åœºæ¬¡æœ€å¤šçš„ç¯®ç½‘é˜Ÿã€‚

![](http://ww1.sinaimg.cn/bmiddle/006tNc79gy1g5ho5iusfbj317e0rw7ah.jpg)


```python
player_stat_2017['games'] = player_stat_2017['games'].astype(int)
player_stat_2017.sort_values(by=['player', 'games'], ascending=[True, False], inplace=True)
player_stat_1 = player_stat_2017.drop_duplicates(subset='player', keep='first')
dup = player_stat_2017[player_stat_2017.duplicated(subset='player', keep=False)].sort_values(by='player')
rem_tot = dup.query('team_id!="TOT"')
rem_tot = rem_tot.sort_values(by=['player', 'games'], ascending=[True, False])
rem_tot = rem_tot.drop_duplicates(subset='player', keep='first')
player_stat_1 = player_stat_1.merge(rem_tot[['player', 'team_id']], how = 'left', left_on = 'player', right_on='player')
player_stat_1['team_id_y'].fillna(player_stat_1['team_id_x'], inplace= True)
player_stat_1.drop('team_id_x', axis = 1, inplace= True)
player_stat_1.rename(columns={'team_id_y':'team_id'}, inplace=True)
player_stat_1[player_stat_1['player'].str.contains('acy')]
```

![](http://ww4.sinaimg.cn/large/006tNc79gy1g5k13rhb1ag30s6024qpv.gif)

å¦ä¸€ä¸ªæ£˜æ‰‹çš„é—®é¢˜å°±æ˜¯ï¼Œéšç€æ—¶ä»£å‘å±•ï¼Œå°çƒæ—¶ä»£å¯¹ä¼ ç»Ÿç¯®çƒæœ‰ç€å¾ˆå¼ºçš„å†²å‡»ï¼Œè”ç›Ÿä¸­çƒå‘˜çš„ä½ç½®ä¸å†æ˜¯å¸¸è§„çš„äº”ä¸ªï¼Œè”ç›Ÿä¸­å‡ºç°äº†å¾ˆå¤šâ€œåŒèƒ½å«â€ã€â€œé”‹ä½æ‘‡æ‘†äººâ€ï¼Œç”šè‡³è¿˜æœ‰å¯ä»¥ä»ä¸€æ‰“åˆ°äº”çš„å…¨èƒ½ç‹ã€‚

![](http://ww4.sinaimg.cn/bmiddle/006tNc79gy1g5hom3cwb7j316y0jo7av.jpg)

è¿™æ ·å¤„ç†èµ·æ¥ä¹Ÿæ¯”è¾ƒéº»çƒ¦ï¼Œæ‰€ä»¥æˆ‘ä»¬å°±ç®€å•åˆ’åˆ†æˆâ€œå‰åœºçƒå‘˜â€ã€â€ååœºçƒå‘˜â€œå’Œâ€œç‰¹æ®Šä½ç½®â€å°±å¥½äº†ã€‚æˆ‘ä»¬çœ‹ä¸€ä¸‹joffry lauvergneçš„ä½ç½®ä¹‹å‰ä¸ºå¤§å‰æˆ–è€…å‡ºä»»ä¸­é”‹ï¼Œç°åœ¨å˜æˆäº†â€œç‰¹æ®Šä½ç½®â€ã€‚

![](http://ww4.sinaimg.cn/bmiddle/006tNc79gy1g5hor6c1wej30ys0mqgp0.jpg)


```python
player_stat_1['pos'].unique()
player_stat_1['new_pos'] = player_stat_1['pos'].apply(lambda x: 'back' if x in(['SG','PG','PG-SG']) 
                           else ('front' if x in ['PF','C','SF'] else 'special'))

player_stat_1[player_stat_1['player'].str.contains('lauvergne')]
```

![](http://ww3.sinaimg.cn/large/006tNc79gy1g5k154v6zgg30s6024quh.gif)

æˆ‘ä»¬å°†`team_rank.csv`ä¹Ÿæ·»åŠ è¿›å»ã€‚æ¥çœ‹ä¸€ä¸‹å‡ ä¸ªè©¹å§†æ–¯çš„å›¢é˜Ÿæ•°æ®å§ï¼


```python
team_rank = pd.read_csv('./csv/team_rank.csv')
player_stat_1 = player_stat_1.merge(team_rank, how = 'left', left_on='team_id', right_on='team_id')
player_stat_1.rename(columns={'rank_x':'player_rank', 'rank_y':'team_rank', 'points':'team_points'}, inplace=True)
player_stat_1[player_stat_1['player'].str.contains('james')]
```

![](http://ww1.sinaimg.cn/large/006tNc79gy1g5k1686k1kg30s00561ky.gif)

ä¸ºäº†ä¾¿äºå¤„ç†æ•°æ®ï¼Œæˆ‘ä»¬é‡å»ºdata frameï¼Œå¹¶æŒ‡å®šäº†æ¯ä¸€ä¸ªstatçš„æ•°æ®ç±»å‹ã€‚


```python
int_col = ['age',  'games', 'games_started', 'team_rank']
float_col = ['min_per_game', 'field_goals', 'field_goals_attempts',
       'field_goals_pct', '3points', '3points_attempts', '3points_pct',
       '2points', '2points_attempts', '2points_pct', 'efg_pct', 'free_throws',
       'free_throws_attempts', 'free_throws_pct', 'orb', 'drb', 'trb',
            'assists', 'steals', 'blocks', 'turnovers', 'personal_fouls',
       'points_per_game', 'team_points']
string_col = ['team_id']

player_stat_1[int_col] = player_stat_1[int_col].apply(pd.to_numeric, axis = 1)
player_stat_1[float_col] = player_stat_1[float_col].apply(pd.to_numeric, axis = 1)
player_stat_1[string_col] = player_stat_1[string_col].astype('|S5')
player_stat_1.info()
```

![](http://ww1.sinaimg.cn/bmiddle/006tNc79gy1g5k16rwzezj30t2140ait.jpg)


è¿™æ ·ï¼Œæ•°æ®é¢„å¤„ç†å°±æš‚æ—¶å®Œæˆäº†ï¼Œæˆ‘ä»¬æŠŠå®ƒå°è£…åˆ°äº†`data_processing_over.pkl`åŒ…ä¸­ã€‚ç„¶åè®©æˆ‘ä»¬çœ‹ä¸€ä¸‹NBAé‡Œä¿ç½—**ä»¬**çš„æ•°æ®å§ï¼


```python
player_stat_1.to_pickle('./pkl/data_processing_over.pkl')
player_stat_1[player_stat_1['player'].str.contains('paul')]
```

![](http://ww2.sinaimg.cn/large/006tNc79gy1g5k180otfcg30s00561ky.gif)

---

## åˆ†æ

å¤„ç†æ•°æ®ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦åˆ†æä¸€ä¸‹æ•°æ®é›†ã€‚

### æ•°æ®å¯è§†åŒ–

é¦–å…ˆæˆ‘ä»¬å°†æ•°æ®é›†å¯è§†åŒ–äº†ä¸€ä¸‹ï¼Œå¯ä»¥çœ‹å‡ºï¼šé«˜è–ªçƒå‘˜å¤§éƒ¨åˆ†éƒ½åœ¨30å²å·¦å³ï¼Œå¹´å°‘æœ‰ä¸ºçš„å¹´è½»çƒå‘˜è¿˜æ˜¯å°‘ï¼›è”ç›Ÿçš„è€å°†æœ‰äº›ä¹Ÿè™è½å¹³é˜³ã€‚æ­¤å¤–ï¼Œç»¼åˆæ¥çœ‹ï¼Œ**å‰åœºçƒå‘˜æ‹¿åˆ°é«˜è–ªæ°´çš„å¤šï¼Œè™½ç„¶ä»–ä»¬å¾—åˆ†å¹¶ä¸æ¯”åå«ä»¬ä¼˜ç§€**ã€‚åœ¨åŠ©æ”»æ–¹é¢ï¼Œåå«æ¯”è¾ƒå¼ºåŠ¿ï¼›åœ¨ç¯®æ¿æ–¹é¢ï¼Œé”‹çº¿æ¯”è¾ƒå‰å®³ã€‚

![](http://ww3.sinaimg.cn/bmiddle/006tNc79gy1g5hxmcaivcj30ni0eojsr.jpg)


```python
all_data = pd.read_pickle('./pkl/data_processing_over.pkl')

X_vis = all_data[['points_per_game','assists','trb','steals', 'blocks','steals','turnovers','age','new_pos','team_rank']]
y_vis = all_data[['salary']]

# PPG
fig = plt.figure(figsize=(16,8))
fig.add_subplot(311)
plt.grid(lw=0)
cm = plt.cm.get_cmap('PuBu')
for i in range(len(X_vis)):
    xs = float(X_vis['points_per_game'][i])
    zs = float(y_vis['salary'][i])
    if X_vis['new_pos'][i]=='front':
        ma = '^'
    else:
        ma = 'o' 
    plt.scatter(xs,zs,s=35,c=int(X_vis['age'][i]),vmin=18, vmax=38, cmap=cm, marker=ma, alpha=0.9)
cb=plt.colorbar()
font = {'family' : 'serif',
        'color'  : '#000000',
        'weight' : 'normal',
        }
plt.xlabel('Point Per Game')
plt.ylabel('Player Salary')
cb.set_label('Player Age',fontdict=font)
plt.show()

# Asists
fig = plt.figure(figsize=(16,8))
fig.add_subplot(312)
plt.grid(lw=0)
cm = plt.cm.get_cmap('Reds')
for i in range(len(X_vis)):
    xs = float(X_vis['assists'][i])
    zs = float(y_vis['salary'][i])
    if X_vis['new_pos'][i]=='front':
        ma = '^'
    else:
        ma = 'o' 
    plt.scatter(xs,zs,s=35,c=int(X_vis['age'][i]),vmin=18, vmax=38, cmap=cm, marker=ma, alpha=0.9)
cb=plt.colorbar()
font = {'family' : 'serif',
        'color'  : '#000000',
        'weight' : 'normal',
        }
plt.xlabel('Assists')
plt.ylabel('Player Salary')
cb.set_label('Player Age',fontdict=font)
plt.show()

# Rebounds
fig = plt.figure(figsize=(16,8))
fig.add_subplot(313)
plt.grid(lw=0)
cm = plt.cm.get_cmap('Purples')
for i in range(len(X_vis)):
    xs = float(X_vis['trb'][i])
    zs = float(y_vis['salary'][i])
    if X_vis['new_pos'][i]=='front':
        ma = '^'
    else:
        ma = 'o' 
    plt.scatter(xs,zs,s=35,c=int(X_vis['age'][i]),vmin=18, vmax=38, cmap=cm, marker=ma, alpha=0.9)
cb=plt.colorbar()
font = {'family' : 'serif',
        'color'  : '#000000',
        'weight' : 'normal',
        }
plt.xlabel('Total Rebounds')
plt.ylabel('Player Salary')
cb.set_label('Player Age',fontdict=font)
plt.show()

```


![](http://ww4.sinaimg.cn/large/006tNc79gy1g5k05p20saj30nl0543z5.jpg)



![](http://ww2.sinaimg.cn/large/006tNc79gy1g5k05t5po3j30nl054q3i.jpg)



![](http://ww3.sinaimg.cn/large/006tNc79gy1g5k05wl79fj30nl054dgf.jpg)


### ç›¸å…³æ€§åˆ†æ

å› ä¸ºå¾ˆå¤šçƒå‘˜çš„å®åŠ›æŒ‡æ ‡æ˜¯é‡å çš„ï¼Œå¤ªå¤šæŒ‡æ ‡æ„å‘³ç€æ¥ä¸‹æ¥é«˜ç»´åº¦çš„å¤„ç†ã€‚ä¸ºäº†é€‰æ‹©ä¸€äº›æœ‰ç”¨çš„å®åŠ›æŒ‡æ ‡ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œç›¸å…³æ€§åˆ†æã€‚è¿™é‡Œæˆ‘ä»¬å€ŸåŠ©`seaborn`å·¥å…·å°†å„ä¸ªå®åŠ›æŒ‡æ ‡çš„ç›¸å…³æ€§ç”»äº†å‡ºæ¥ã€‚


```python
all_data = pd.read_pickle('./pkl/data_processing_over.pkl')
all_data['Position_back']=np.where((all_data['new_pos']=='back'),1,0)
all_data['Position_front']=np.where((all_data['new_pos']=='front'),1,0)
tmp = all_data[['age', 'games', 'games_started', 'min_per_game', 'field_goals', 'field_goals_attempts', \
                '2points', '2points_attempts', '3points', '3points_attempts',  'free_throws', 'orb', 'drb', \
                'trb', 'assists', 'steals', 'blocks','free_throws_attempts', 'turnovers', 'personal_fouls', \
                'points_per_game', 'team_points','pos']]

if os.path.exists('./fig/sns/sns_plot.pdf') == False:
    sns_plot = sns.pairplot(data = tmp, hue='pos', diag_kind="kde", markers="+",
                              plot_kws=dict(s=50, edgecolor="b", linewidth=1),
                              diag_kws=dict(shade=True))
    sns_plot.savefig("./fig/sns/sns_plot.pdf")
```

![](http://ww2.sinaimg.cn/large/006tNc79gy1g5k08rdf6qj30uj0u04r3.jpg)

ä»å›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºæœ‰ä¸€äº›ç›¸å…³æ€§å¾ˆå¼ºçš„æŒ‡æ ‡ï¼Œåœ¨ä¹‹åæˆ‘ä»¬å°±å¯ä»¥èˆå¼ƒæ‰å®ƒä»¬ä¸­çš„ä¸€ä¸ªï¼Œè¿™æ ·å¯ä»¥è¾¾åˆ°é™ç»´çš„æ•ˆæœã€‚æ¯”å¦‚æŠ•ç¯®å°è¯•æ¬¡æ•°è¶Šå¤šï¼Œå¾—åˆ†è¶Šé«˜ï¼›ä¸€èˆ¬åªæœ‰èƒ½å¤Ÿå¾—åˆ°è¿åŠ¨æˆ˜å¾—åˆ†çš„çƒå‘˜æ‰æœ‰èµ„æ ¼å‚åŠ æ¯”èµ›ï¼ˆ*ä¹Ÿå¯ä»¥è¯´æ˜¯å› ä¸ºä»–ä»¬å‚åŠ äº†æ¯”èµ›æ‰€ä»¥æ‰æœ‰è¿åŠ¨æˆ˜å¾—åˆ†*ï¼‰ã€‚è¿˜æœ‰ä¸€äº›ç›¸å…³æ€§ä¸å¼ºçš„å˜é‡ï¼Œæ¯”å¦‚ä¸‰åˆ†å°è¯•æ¬¡æ•°å’Œç¯®æ¿ï¼Œä¸‰åˆ†å‘½ä¸­ç‡å’Œä¸ªäººçŠ¯è§„æ¬¡æ•°ç­‰å…³ç³»ç›¸å…³æ€§å¾ˆå¼±ï¼Œå¯¹äºè¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬ä¸€èˆ¬æŠŠè¿™äº›æŒ‡æ ‡è§†ä½œç‹¬ç«‹ç»´åº¦ç”¨æ¥å›å½’ã€‚

![](http://ww1.sinaimg.cn/bmiddle/006tNc79gy1g5hxd0o5igj31280pimzs.jpg)

ä¸ºäº†æ›´åŠ ç²¾ç¡®åœ°é˜è¿°å„ä¸ªæŒ‡æ ‡ä¹‹é—´çš„å…³ç³»ï¼Œæˆ‘ä»¬åˆç”»å‡ºæ¥äº†corrcoefå›¾ã€‚pairplotä¸­è¶Šç›¸å…³ï¼ˆ*å‘ˆçº¿å½¢*ï¼‰çš„å…³ç³»åœ¨corrcoefä¸­è¶Šâ€œçƒ­â€ã€‚å¯¹è§’çº¿ä¸Šè¡¨ç¤ºè‡ªåå…³ç³»ï¼Œæ‰€ä»¥éƒ½æ˜¯1.00 ã€‚


```python
tmp = all_data[['age', 'games', 'games_started', 'min_per_game', 'field_goals', 'field_goals_attempts', \
                '2points', '2points_attempts', '3points', '3points_attempts',  'free_throws', 'orb', 'drb', \
                'trb', 'assists', 'steals', 'blocks','free_throws_attempts', 'turnovers', 'personal_fouls', \
                'points_per_game', 'team_points']]

cm = np.corrcoef(tmp.values.T)   
sns.set(font_scale=.8)
plt.figure(figsize=(12,12))
sns.heatmap(cm,cbar=True,annot=True,square=True,fmt='.2f',annot_kws={'size': 11},yticklabels=tmp.T,xticklabels=tmp.T)
plt.savefig('./fig/sns/sns_coeff.pdf', dpi=300)
plt.show()
```


![](http://ww3.sinaimg.cn/large/006tNc79gy1g5k0678fw3j30ii0iutdr.jpg)


## å›å½’

![](http://ww4.sinaimg.cn/bmiddle/006tNc79gy1g5hxsvbnlvj30jq0a8t9q.jpg)

ä¸è¦æ…Œï¼æˆ‘ä»¬è¿™å°±ç”¨å„ç§å›å½’æ¨¡å‹ç»™ä½ ä»¬ç®—å·¥èµ„ğŸ’°ï¼

ä¸ºäº†é¿å…é€ è½®å­çš„éº»çƒ¦ï¼Œæˆ‘ä»¬ç›´æ¥è°ƒç”¨äº†[sklearn](https://scikit-learn.org/stable/)çš„APIï¼Œå¹¶æ ¹æ®[é»„ç –å¤´](http://www.scikit-yb.org/en/latest/)å¯¹æ¨¡å‹è¯„ä¼°æ—¶é™„å¸¦çš„å¾—åˆ†å¯¹æ¯ç§æ–¹æ³•è¿›è¡Œè¯„ä¼°ã€‚æœ€å¥½çš„å¾—åˆ†æ˜¯1.0ï¼Œå½“ç„¶ä¼šå¾—åˆ°è´Ÿçš„åˆ†æ•°ã€‚æ¨¡å‹åˆ†æ•°çš„å®šä¹‰ä¸º$R^2=(1-\mu/\nu)$, where $\mu=((y_{true}-y_{predict})**2).sum()$, $\nu=((y_{true}-y_{mean})**2).sum()$ã€‚

å…¶å®æˆ‘ä½œä¸ºæ•°æ®æŒ–æ˜å°ç™½å¯¹æˆ‘è¿™ä¸ªæ•°æ®é›†ä¸­çš„æ•°æ®ã€å¯¹å„ç§å›å½’æ¨¡å‹çš„ä¼˜åŠ£åŠ¿å¹¶æ²¡æœ‰å¾ˆæ¸…æ™°çš„è®¤è¯†ã€‚æˆ‘çš„principleå°±æ˜¯**â€œè¯•â€**ï¼Œæ‰€ä»¥æˆ‘å‡ ä¹å°è¯•äº†æ‰€æœ‰`sklearn`ä¸­èƒ½å¤Ÿç”¨åˆ°æˆ‘è¿™ä¸ªæ•°æ®é›†ä¸Šçš„å›å½’æ¨¡å‹ã€‚ä¸å¾—ä¸è¯´ï¼Œ`sklearn`çœŸçš„æ˜¯è¶…çº§è‰¯å¿ƒï¼Œä¸»é¡µä¸Šçš„å…­ä¸ªmodulesç›´æ¥ä¸ºæˆ‘ä»¬æŒ‡å¼•äº†æ–¹å‘ã€‚åªéœ€è°ƒç”¨æ‚¨éœ€æ±‚åŠŸèƒ½çš„APIï¼Œä¸åœå°è¯•æ¢å‚å’Œæ¢æ¨¡å‹ï¼Œå°±å¯ä»¥è¾¾åˆ°ç†æƒ³çš„ç»“æœã€‚â€œå®ƒå¯çœŸæ˜¯æ•°æ®åˆ†æä¸–ç•Œçš„è‰¯å¿ƒå•Šï¼â€

![](http://ww1.sinaimg.cn/bmiddle/006tNc79gy1g5jxiaxiu8j30zc0u018m.jpg)

é¦–å…ˆéœ€è¦å…ˆä¸‹ä¸€ä¸ª[é»„ç –å¤´](http://www.scikit-yb.org/en/latest/)ğŸ§±ç”¨æ¥å¯è§†åŒ–å’Œåˆæ­¥è¯„ä¼°å›å½’æ¨¡å‹çš„æ€§èƒ½ã€‚


```python
import sys
!{sys.executable} -m pip install yellowbrick
```


ç„¶åæŠŠè½®å­éƒ½importä¸€ä¸‹ã€‚


```python
import sklearn
import yellowbrick
from sklearn.model_selection import train_test_split
from sklearn import decomposition
from sklearn.linear_model import LinearRegression, Lasso, Ridge, RidgeCV, ElasticNet
from sklearn.svm import SVR
from sklearn.tree import DecisionTreeRegressor
from sklearn.neighbors import KNeighborsRegressor
from sklearn.ensemble import RandomForestRegressor, GradientBoostingRegressor, \
ExtraTreesRegressor
from yellowbrick.regressor import PredictionError
from sklearn.neural_network import MLPRegressor
```

åœ¨å›å½’ä¹‹å‰ï¼Œæˆ‘ä»¬è¿˜éœ€è¦é‡æ–°å®šä¹‰ä¸€ä¸‹æ•°æ®ã€‚é¦–å…ˆç”¨PCAå†é™ä¸€ä¸‹ç»´ï¼Œç„¶ååˆ†è£‚æ•°æ®é›†æˆè®­ç»ƒé›†å’Œæµ‹è¯•é›†ã€‚


```python
# Specify the features of interest and the target

# Extract the instances and target
X = all_data[['age', 'games', 'games_started', 'min_per_game', 'field_goals', 'field_goals_attempts', \
              '2points', '2points_attempts', '3points', '3points_attempts',  'free_throws', 'orb',\
              'drb', 'trb', 'assists', 'steals', 'blocks','free_throws_attempts', \
              'turnovers', 'personal_fouls', 'points_per_game', 'team_points']]
y = all_data['salary']

# PCA decomposition -- seems do not effect...
pca = decomposition.PCA(n_components=8)
pca.fit(X)
X = pca.transform(X)

# Create the train and test data
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2)
```

ä¸‹é¢æˆ‘ä»¬å°±å¯ä»¥æ­£å¼å¼€å§‹å›ï¼ˆshiï¼‰å½’ï¼ˆcanï¼‰å•¦ï¼

![](http://ww1.sinaimg.cn/bmiddle/006tNc79gy1g5hy081ue9j30g4092aad.jpg)

### å¹¿ä¹‰çº¿æ€§æ¨¡å‹

é¦–å…ˆï¼Œæˆ‘ä»¬å°è¯•äº†ä¸€ç»„å¹¿ä¹‰çº¿æ€§å›å½’çš„æ–¹æ³•ï¼Œå…¶ä¸­ç›®æ ‡å€¼é¢„æœŸä¸ºç‰¹å¾çš„çº¿æ€§ç»„åˆã€‚

$$\hat{y}(w,x)=w_0+w_1 x_1+\cdots+w_p x_p$$

#### å¤šå…ƒçº¿æ€§å›å½’

æˆ‘ä»¬å…ˆé‡‡ç”¨æœ€ç®€å•çš„çº¿æ€§æ¨¡å‹â€”â€”å¤šå…ƒçº¿æ€§å›å½’ã€‚çº¿æ€§å›å½’æ˜¯åˆ©ç”¨æ•°ç†ç»Ÿè®¡ä¸­å›å½’åˆ†æï¼Œæ¥ç¡®å®šä¸¤ç§æˆ–ä¸¤ç§ä»¥ä¸Šå˜é‡é—´ç›¸äº’ä¾èµ–çš„å®šé‡å…³ç³»çš„ä¸€ç§ç»Ÿè®¡åˆ†ææ–¹æ³•ã€‚å…¶è¡¨è¾¾å½¢å¼ä¸º$y = w'x+e$ï¼Œ$e$ä¸ºè¯¯å·®æœä»å‡å€¼ä¸º0çš„æ­£æ€åˆ†å¸ƒã€‚

![](http://ww4.sinaimg.cn/bmiddle/006tNc79gy1g5hy1ofq59j31n40u042q.jpg)

æˆ‘ä»¬å…ˆå®šä¹‰å¥½ä¸€ä¸ªçº¿æ€§å›å½’å™¨ï¼Œç„¶åç”¨é»„è½¬å¤´ğŸ§±å¯è§†åŒ–å¹¶è¯„åˆ†ï¼Œæœ€åç”¨æ•£ç‚¹å›¾å±•ç¤ºäº†419ä¸ªæœ‰æ•ˆæ•°æ®ä¸­çƒå‘˜çœŸå®å·¥èµ„ä¸é¢„æµ‹è–ªæ°´ä¹‹é—´çš„å·®è·ã€‚


```python
# Instantiate the model and visualizer
lr = LinearRegression()
visualizer = PredictionError(lr)

visualizer.fit(X_train, y_train)  # Fit the training data to the visualizer
visualizer.score(X_test, y_test)  # Evaluate the model on the test data
g = visualizer.poof()             # Draw/show/poof the data

# Prediction plot (simple LR using scatter)
predictions = lr.predict(X)
prd_lr = predictions.astype(int)
x = range(len(prd_lr))
plt.figure(figsize=(6,4))
plt.grid(ls=':', lw=1)
plt.scatter(x, prd_lr, color='#FEB64D', marker='o', facecolor='None', lw=2)
plt.scatter(x, y, color='#9287E7', marker='o')
label = ["Prediction", "Actual"]
plt.legend(label, loc=2, markerscale=0.85, ncol = 1, fontsize=10, framealpha=1)
plt.title('Linear Regression', fontsize=12)
plt.savefig("./fig/reg/lr.png")
plt.show()

# Show score
print("Model Score: ",lr.score(X_test, y_test))
```


![](http://ww2.sinaimg.cn/large/006tNc79gy1g5k09d2dnpj309u09z0t3.jpg)

![](http://ww2.sinaimg.cn/large/006tNc79gy1g5k09h7c37j30aa079abk.jpg)


    Model Score:  0.45663550413795606


#### Lassoå›å½’

![](http://ww3.sinaimg.cn/bmiddle/006tNc79gy1g5hyfbuhhvj318g0rf78v.jpg)

Lassoå›å½’æ¨¡å‹æ˜¯ä¸€ä¸ªç”¨äºä¼°è®¡ç¨€ç–å‚æ•°çš„çº¿æ€§æ¨¡å‹ï¼ŒLassoåœ¨çº¿æ€§æ¨¡å‹ä¸ŠåŠ ä¸Šäº†ä¸€ä¸ªl1æ­£åˆ™é¡¹ï¼Œç‰¹åˆ«é€‚ç”¨äºå‚æ•°æ•°ç›®ç¼©å‡ã€‚åŸºäºè¿™ä¸ªåŸå› ï¼ŒLassoå›å½’æ¨¡å‹åœ¨å‹ç¼©æ„ŸçŸ¥ä¸­åº”ç”¨çš„ååˆ†å¹¿æ³›ã€‚

![](http://ww4.sinaimg.cn/bmiddle/006tNc79gy1g5hyn6a6umj31uo0u00uq.jpg)

æˆ‘ä»¬å…ˆå®šä¹‰å¥½ä¸€ä¸ªLassoå›å½’å™¨ï¼Œç„¶åç”¨é»„è½¬å¤´ğŸ§±å¯è§†åŒ–å¹¶è¯„åˆ†ï¼Œæœ€åç”¨æ•£ç‚¹å›¾å±•ç¤ºäº†419ä¸ªæœ‰æ•ˆæ•°æ®ä¸­çƒå‘˜çœŸå®å·¥èµ„ä¸é¢„æµ‹è–ªæ°´ä¹‹é—´çš„å·®è·ã€‚


```python
# Instantiate the model and visualizer
lasso = Lasso()
visualizer = PredictionError(lasso)

visualizer.fit(X_train, y_train)  # Fit the training data to the visualizer
visualizer.score(X_test, y_test)  # Evaluate the model on the test data
g = visualizer.poof()             # Draw/show/poof the data

# Prediction plot
predictions = lasso.predict(X)
prd_lasso = predictions.astype(int)
plt.figure(figsize=(6,4))
x = range(len(prd_lasso))
plt.grid(ls=':', lw=1)
plt.scatter(x, prd_lasso, color='#FEB64D', marker='o', facecolor='None', lw=2)
plt.scatter(x, y, color='#9287E7', marker='o')
label = ["Prediction", "Actual"]
plt.legend(label, loc=2, markerscale=0.85, ncol = 1, fontsize=10, framealpha=1)

plt.title('Lasso Regression', fontsize=12)
plt.savefig("./fig/reg/lasso.png")
plt.show()

# Show score
print("Model Score: ",lasso.score(X_test, y_test))
```


![](http://ww4.sinaimg.cn/large/006tNc79gy1g5k09viecej309u09zaae.jpg)

![](http://ww2.sinaimg.cn/large/006tNc79gy1g5k09zbsxxj30aa079dhc.jpg)


    Model Score:  0.45663555627227415


#### å²­å›å½’

å²­å›å½’æ˜¯ä¸€ç§ä¸“ç”¨äºå…±çº¿æ€§æ•°æ®åˆ†æçš„æœ‰åä¼°è®¡å›å½’æ–¹æ³•ï¼Œå®è´¨ä¸Šæ˜¯ä¸€ç§æ”¹è‰¯çš„æœ€å°äºŒä¹˜ä¼°è®¡æ³•ï¼Œé€šè¿‡æ”¾å¼ƒæœ€å°äºŒä¹˜æ³•çš„æ— åæ€§ï¼Œä»¥æŸå¤±éƒ¨åˆ†ä¿¡æ¯ã€é™ä½ç²¾åº¦ä¸ºä»£ä»·è·å¾—å›å½’ç³»æ•°æ›´ä¸ºç¬¦åˆå®é™…ã€æ›´å¯é çš„å›å½’æ–¹æ³•ï¼Œå¯¹ç—…æ€æ•°æ®çš„æ‹Ÿåˆè¦å¼ºäºæœ€å°äºŒä¹˜æ³•ã€‚

![](http://ww4.sinaimg.cn/bmiddle/006tNc79gy1g5hyr8bjwnj319d0u0gnx.jpg)

æˆ‘ä»¬å…ˆå®šä¹‰å¥½ä¸€ä¸ª$\alpha=0.1$çš„Ridgeå›å½’å™¨ï¼Œç„¶åç”¨é»„è½¬å¤´ğŸ§±å¯è§†åŒ–å¹¶è¯„åˆ†ï¼Œç”¨æ•£ç‚¹å›¾å±•ç¤ºäº†419ä¸ªæœ‰æ•ˆæ•°æ®ä¸­çƒå‘˜çœŸå®å·¥èµ„ä¸é¢„æµ‹è–ªæ°´ä¹‹é—´çš„å·®è·ã€‚ä¹‹åæˆ‘ä»¬åˆå°è¯•äº†`alphas=[0.01, 0.1, 1.0, 10.0]`çš„ridgeCVå›å½’å™¨ï¼Œè¿™ç§å›å½’å™¨çš„ä¼˜åŠ¿åœ¨äºå¯ä»¥è‡ªåŠ¨åœ°æŒ‘é€‰æ›´åŠ åˆé€‚çš„å‚æ•°ã€‚ç»è¿‡å°è¯•ï¼Œå‘ç°CVå›å½’å™¨ç¡®å®èƒ½å¤ŸenhanceåŸæœ‰çš„å›å½’å™¨ã€‚

![](http://ww1.sinaimg.cn/bmiddle/006tNc79gy1g5hyqaavrvj318g0m30x2.jpg)


```python
# Instantiate the model and visualizer
ridge = Ridge(alpha=0.1)
visualizer = PredictionError(ridge)
visualizer.fit(X_train, y_train)  # Fit the training data to the visualizer
visualizer.score(X_test, y_test)  # Evaluate the model on the test data
g = visualizer.poof()             # Draw/show/poof the data

# Prediction plot
predictions = ridge.predict(X)
prd_ridge = predictions.astype(int)
plt.figure(figsize=(6,4))
x = range(len(prd_ridge))
plt.grid(ls=':', lw=1)
plt.scatter(x, prd_ridge, color='#FEB64D', marker='o', facecolor='None', lw=2)
plt.scatter(x, y, color='#9287E7', marker='o')
label = ["Prediction", "Actual"]
plt.legend(label, loc=2, markerscale=0.85, ncol = 1, fontsize=10, framealpha=1)
plt.title('Ridge Regression', fontsize=12)
plt.savefig("./fig/reg/ridge.png")
plt.show()

# Show score
print("Model Score: ",ridge.score(X_test, y_test))
```


![](http://ww3.sinaimg.cn/large/006tNc79gy1g5k0a5p6kkj309u09zaae.jpg)

![](http://ww3.sinaimg.cn/large/006tNc79gy1g5k0a8s82sj30aa079jsw.jpg)


    Model Score:  0.45664410518908105



```python
# Instantiate the model and visualizer
ridgeCV = RidgeCV(alphas=[0.01, 0.1, 1.0, 10.0])
visualizer = PredictionError(ridgeCV)
visualizer.fit(X_train, y_train)  # Fit the training data to the visualizer
visualizer.score(X_test, y_test)  # Evaluate the model on the test data
g = visualizer.poof()             # Draw/show/poof the data

# Prediction plot
predictions = ridgeCV.predict(X)
prd_ridgeCV = predictions.astype(int)
plt.figure(figsize=(6,4))
x = range(len(prd_ridgeCV))
plt.grid(ls=':', lw=1)
plt.scatter(x, prd_ridgeCV, color='#FEB64D', marker='o', facecolor='None', lw=2)
plt.scatter(x, y, color='#9287E7', marker='o')
label = ["Prediction", "Actual"]
plt.legend(label, loc=2, markerscale=0.85, ncol = 1, fontsize=10, framealpha=1)

plt.title('RidgeCV Regression', fontsize=12)
plt.savefig("./fig/reg/ridgeCV.png")
plt.show()

# Show score
print("Model Score: ",ridgeCV.score(X_test, y_test))
```


![](http://ww1.sinaimg.cn/large/006tNc79gy1g5k0abno9jj309u09zmxi.jpg)

![](http://ww4.sinaimg.cn/large/006tNc79gy1g5k0af5l3sj30aa079jsw.jpg)


    Model Score:  0.4574808811208244


#### å¼¹æ€§ç½‘ç»œ

å¼¹æ€§ç½‘ç»œæ˜¯ä¸€ç§çº¿æ€§å›å½’æ¨¡å‹ï¼Œè®­ç»ƒäº†$l_1$å’Œ$l_2$-èŒƒæ•°æ­£åˆ™åŒ–ç³»æ•°ã€‚è¿™ç§ç»„åˆå…è®¸å­¦ä¹ ç¨€ç–æ¨¡å‹ï¼Œå…¶ä¸­å¾ˆå°‘çš„æƒé‡æ˜¯éé›¶çš„ï¼ŒåŒæ—¶ä»ç„¶ä¿æŒå²­çš„æ­£åˆ™åŒ–å±æ€§ã€‚åˆ©ç”¨`l1_ratio`å‚æ•°æ§åˆ¶l1å’Œl2çš„å‡¸ç»„åˆã€‚å½“å­˜åœ¨å¤šä¸ªç›¸äº’å…³è”çš„ç‰¹å¾æ—¶ï¼Œå¼¹æ€§ç½‘ç»œå¯èƒ½åŒæ—¶é€‰æ‹©ä¸¤ä¸ªã€‚å®ƒåœ¨Lassoå’ŒRidgeä¹‹é—´è¿›è¡Œæƒè¡¡ï¼Œå…è®¸å¼¹æ€§ç½‘åœ¨æ—‹è½¬æ—¶ç»§æ‰¿Ridgeçš„ä¸€äº›ç¨³å®šæ€§ã€‚

![](http://ww3.sinaimg.cn/bmiddle/006tNc79gy1g5jwo75ck6j30hs0dcq4k.jpg)


```python
# Instantiate the model and visualizer
enet = ElasticNet(alpha=0.1, l1_ratio=0.7)
visualizer = PredictionError(enet)
visualizer.fit(X_train, y_train)  # Fit the training data to the visualizer
visualizer.score(X_test, y_test)  # Evaluate the model on the test data
g = visualizer.poof()             # Draw/show/poof the data

# Prediction plot
predictions = enet.predict(X)
prd_enet = predictions.astype(int)
plt.figure(figsize=(6,4))
x = range(len(prd_enet))
plt.grid(ls=':', lw=1)
plt.scatter(x, prd_enet, color='#FEB64D', marker='o', facecolor='None', lw=2)
plt.scatter(x, y, color='#9287E7', marker='o')
label = ["Prediction", "Actual"]
plt.legend(label, loc=2, markerscale=0.85, ncol = 1, fontsize=10, framealpha=1)

plt.title('Elastic Net Regression', fontsize=12)
plt.savefig("./fig/reg/enet.png")
plt.show()

# Show score
print("Model Score: ",enet.score(X_test, y_test))
```


![](http://ww3.sinaimg.cn/large/006tNc79gy1g5k0aheyigj309u09zjrq.jpg)

![](http://ww3.sinaimg.cn/large/006tNc79gy1g5k0alns6ej30aa079jsw.jpg)


    Model Score:  0.4574576128442218


### æ”¯æŒå‘é‡æœº

æ”¯æŒå‘é‡æœºåˆ†ç±»æ–¹æ³•å¯ä»¥æ¨å¹¿åˆ°å›å½’é—®é¢˜çš„æ±‚è§£ï¼Œç§°ä¸ºæ”¯æŒå‘é‡å›å½’ã€‚

![](http://ww4.sinaimg.cn/bmiddle/006tNc79gy1g5hyx6idfpj30lk07mt93.jpg)

æ”¯æŒå‘é‡åˆ†ç±»ç”Ÿæˆçš„æ¨¡å‹åªä¾èµ–äºè®­ç»ƒæ•°æ®çš„å­é›†ï¼Œæ„å»ºæ¨¡å‹çš„æˆæœ¬å‡½æ•°å¹¶ä¸å…³å¿ƒè¶…å‡ºè¾¹ç•Œçš„è®­ç»ƒç‚¹ã€‚æ”¯æŒå‘é‡å›å½’ç”Ÿæˆçš„æ¨¡å‹åªä¾èµ–äºè®­ç»ƒæ•°æ®çš„ä¸€ä¸ªå­é›†ï¼Œè€Œä¸”ç”¨äºæ„å»ºæ¨¡å‹çš„æˆæœ¬å‡½æ•°å¿½ç•¥äº†ä»»ä½•æ¥è¿‘äºæ¨¡å‹é¢„æµ‹çš„è®­ç»ƒæ•°æ®ã€‚

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å…ˆå®šä¹‰å¥½ä¸€ä¸ªæ”¯æŒå‘é‡å›å½’å™¨ï¼Œç„¶åç”¨é»„è½¬å¤´ğŸ§±å¯è§†åŒ–å¹¶è¯„åˆ†ï¼Œæœ€åç”¨æ•£ç‚¹å›¾å±•ç¤ºäº†419ä¸ªæœ‰æ•ˆæ•°æ®ä¸­çƒå‘˜çœŸå®å·¥èµ„ä¸é¢„æµ‹è–ªæ°´ä¹‹é—´çš„å·®è·ã€‚

```python
# Instantiate the model and visualizer
svr = SVR(kernel='poly')
visualizer = PredictionError(svr)
visualizer.fit(X_train, y_train)  # Fit the training data to the visualizer
visualizer.score(X_test, y_test)  # Evaluate the model on the test data
g = visualizer.poof()             # Draw/show/poof the data

# Prediction plot
predictions = svr.predict(X)
prd_svr = predictions.astype(int)
plt.figure(figsize=(6,4))
x = range(len(prd_svr))
plt.grid(ls=':', lw=1)
plt.scatter(x, prd_svr, color='#FEB64D', marker='o', facecolor='None', lw=2)
plt.scatter(x, y, color='#9287E7', marker='o')
label = ["Prediction", "Actual"]
plt.legend(label, loc=2, markerscale=0.85, ncol = 1, fontsize=10, framealpha=1)

plt.title('Support Vector Regression', fontsize=12)
plt.savefig("./fig/reg/svr.png")
plt.show()

# Show score
print("Model Score: ",svr.score(X_test, y_test))
```



![](http://ww4.sinaimg.cn/large/006tNc79gy1g5k0aq6o19j309u09z74m.jpg)

![](http://ww3.sinaimg.cn/large/006tNc79gy1g5k0aswlpxj30aa079q49.jpg)


    Model Score:  0.3449399132513786


### å†³ç­–æ ‘

![](http://ww1.sinaimg.cn/bmiddle/006tNc79gy1g5hz9utmc2j31o40u00zx.jpg)

å†³ç­–æ ‘æ˜¯ä¸€ç§ç”¨äºåˆ†ç±»å’Œå›å½’çš„éå‚æ•°ç›‘ç£å­¦ä¹ æ–¹æ³•ã€‚ç›®æ ‡æ˜¯åˆ›å»ºä¸€ä¸ªæ¨¡å‹ï¼Œé€šè¿‡å­¦ä¹ ä»æ•°æ®ç‰¹æ€§æ¨æ–­å‡ºçš„ç®€å•å†³ç­–è§„åˆ™æ¥é¢„æµ‹ç›®æ ‡å˜é‡çš„å€¼ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œå†³ç­–æ ‘ä»æ•°æ®ä¸­å­¦ä¹ å¦‚ä½•ä½¿ç”¨ä¸€ç»„if-then-elseå†³ç­–è§„åˆ™æ¥è¿‘ä¼¼æ­£å¼¦æ›²çº¿ã€‚æ ‘è¶Šæ·±ï¼Œå†³ç­–è§„åˆ™è¶Šå¤æ‚ï¼Œæ¨¡å‹è¶Šåˆé€‚ã€‚

![](http://ww4.sinaimg.cn/bmiddle/006tNc79gy1g5hzfztlypj30va0iujsx.jpg)

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å…ˆå®šä¹‰å¥½ä¸€ä¸ªDecision Treeå›å½’å™¨ï¼Œç„¶åç”¨é»„è½¬å¤´ğŸ§±å¯è§†åŒ–å¹¶è¯„åˆ†ï¼Œæœ€åç”¨æ•£ç‚¹å›¾å±•ç¤ºäº†419ä¸ªæœ‰æ•ˆæ•°æ®ä¸­çƒå‘˜çœŸå®å·¥èµ„ä¸é¢„æµ‹è–ªæ°´ä¹‹é—´çš„å·®è·ã€‚


```python
# Instantiate the model and visualizer
decision_tree = DecisionTreeRegressor()
# decision_tree = DecisionTreeRegressor(max_depth=3)
visualizer = PredictionError(decision_tree)
visualizer.fit(X_train, y_train)  # Fit the training data to the visualizer
visualizer.score(X_test, y_test)  # Evaluate the model on the test data
g = visualizer.poof()             # Draw/show/poof the data

# Prediction plot
predictions = decision_tree.predict(X)
prd_decision_tree = predictions.astype(int)
plt.figure(figsize=(6,4))
x = range(len(prd_decision_tree))
plt.grid(ls=':', lw=1)
plt.scatter(x, prd_decision_tree, color='#FEB64D', marker='o', facecolor='None', lw=2)
plt.scatter(x, y, color='#9287E7', marker='o')
label = ["Prediction", "Actual"]
plt.legend(label, loc=2, markerscale=0.85, ncol = 1, fontsize=10, framealpha=1)

plt.title('Decision Tree Regression', fontsize=12)
plt.savefig("./fig/reg/decision_tree.png")
plt.show()

# Show score
print("Model Score: ",decision_tree.score(X_test, y_test))
```


![](http://ww3.sinaimg.cn/large/006tNc79gy1g5k0azfswsj309u09z0t3.jpg)

![](http://ww4.sinaimg.cn/large/006tNc79gy1g5k0b2jwlaj30aa079gmw.jpg)


    Model Score:  0.4176739276920418


### è¿‘é‚»æ–¹æ³•

æœ€è¿‘é‚»æ–¹æ³•çš„åŸç†æ˜¯æ‰¾åˆ°è·ç¦»æ–°ç‚¹æœ€è¿‘çš„é¢„å®šä¹‰è®­ç»ƒæ ·æœ¬ä¸ªæ•°ï¼Œå¹¶æ®æ­¤é¢„æµ‹æ ‡ç­¾ã€‚

![](http://ww3.sinaimg.cn/bmiddle/006tNc79gy1g5jxxt9ozbj318s0k40un.jpg)

é¡¾åæ€ä¹‰ï¼ŒK-æœ€è¿‘é‚»æ–¹æ³•çš„åŸç†è‡ªç„¶å°±æ˜¯æ˜¯æ‰¾åˆ°è·ç¦»æ–°ç‚¹æœ€è¿‘çš„é¢„å®šä¹‰è®­ç»ƒæ ·æœ¬ä¸ªæ•°ï¼Œå¹¶æ®æ­¤é¢„æµ‹æ ‡ç­¾ã€‚æ ·æœ¬çš„æ•°é‡å¯ä»¥æ˜¯ä¸€ä¸ªç”¨æˆ·å®šä¹‰çš„å¸¸æ•°ï¼Œä¹Ÿå¯ä»¥æ ¹æ®ç‚¹çš„å±€éƒ¨å¯†åº¦å˜åŒ–ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè·ç¦»å¯ä»¥æ˜¯ä»»ä½•åº¦é‡ï¼šæ ‡å‡†æ¬§æ°è·ç¦»æ˜¯æœ€å¸¸è§çš„é€‰æ‹©ã€‚

![](http://ww2.sinaimg.cn/bmiddle/006tNc79gy1g5hzm75sdmj30hs0dcwfj.jpg)

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å…ˆå®šä¹‰å¥½ä¸€ä¸ªKNNå›å½’å™¨ï¼Œç„¶åç”¨é»„è½¬å¤´ğŸ§±å¯è§†åŒ–å¹¶è¯„åˆ†ï¼Œæœ€åç”¨æ•£ç‚¹å›¾å±•ç¤ºäº†419ä¸ªæœ‰æ•ˆæ•°æ®ä¸­çƒå‘˜çœŸå®å·¥èµ„ä¸é¢„æµ‹è–ªæ°´ä¹‹é—´çš„å·®è·ã€‚


```python
# Instantiate the model and visualizer
knn = KNeighborsRegressor(weights="uniform")
visualizer = PredictionError(knn)
visualizer.fit(X_train, y_train)  # Fit the training data to the visualizer
visualizer.score(X_test, y_test)  # Evaluate the model on the test data
g = visualizer.poof()             # Draw/show/poof the data

# Prediction plot
predictions = knn.predict(X)
prd_knn = predictions.astype(int)
plt.figure(figsize=(6,4))
x = range(len(prd_knn))
plt.grid(ls=':', lw=1)
plt.scatter(x, prd_knn, color='#FEB64D', marker='o', facecolor='None', lw=2)
plt.scatter(x, y, color='#9287E7', marker='o')
label = ["Prediction", "Actual"]
plt.legend(label, loc=2, markerscale=0.85, ncol = 1, fontsize=10, framealpha=1)

plt.title('KNN Regression', fontsize=12)
plt.savefig("./fig/reg/knn.png")
plt.show()

# Show score
print("Model Score: ",knn.score(X_test, y_test))
```


![](http://ww1.sinaimg.cn/large/006tNc79gy1g5k0b6j35kj309u09zgly.jpg)

![](http://ww3.sinaimg.cn/large/006tNc79gy1g5k0b9554mj30aa079ta4.jpg)


    Model Score:  0.4736951433350763


### é›†æˆæ–¹æ³•

é›†æˆæ–¹æ³•çš„ç›®æ ‡æ˜¯å°†å¤šä¸ªåŸºæœ¬ä¼°è®¡å™¨çš„é¢„æµ‹ä¸ç»™å®šçš„å­¦ä¹ ç®—æ³•ç›¸ç»“åˆï¼Œä»è€Œæé«˜å¯¹å•ä¸ªä¼°è®¡å™¨çš„é€šç”¨æ€§å’Œé²æ£’æ€§ã€‚

é›†æˆæ–¹æ³•é€šå¸¸åˆ†ä¸ºä¸¤å¤§ç±»:

1. åœ¨**å¹³å‡æ–¹æ³•**ä¸­ï¼Œé©±åŠ¨åŸåˆ™æ˜¯ç‹¬ç«‹åœ°æ„å»ºå‡ ä¸ªä¼°è®¡å™¨ï¼Œç„¶åå¯¹å®ƒä»¬çš„é¢„æµ‹è¿›è¡Œå¹³å‡ã€‚å¹³å‡è€Œè¨€ï¼Œç»„åˆä¼°è®¡é‡é€šå¸¸æ¯”ä»»ä½•å•åŸºä¼°è®¡é‡éƒ½å¥½ï¼Œå› ä¸ºå®ƒçš„æ–¹å·®å‡å°äº†ï¼›

2. åœ¨**å¢å¼ºæ–¹æ³•**ä¸­ï¼ŒåŸºæœ¬ä¼°è®¡é‡æ˜¯æŒ‰é¡ºåºå»ºç«‹çš„ï¼Œå¹¶è¯•å›¾å‡å°‘ç»„åˆä¼°è®¡é‡çš„åå·®ã€‚è¿™æ ·åšçš„åŠ¨æœºæ˜¯å°†å‡ ä¸ªè¾ƒå¼±çš„æ¨¡å‹ç»„åˆèµ·æ¥ï¼Œå½¢æˆä¸€ä¸ªå¼ºå¤§çš„æ•´ä½“ã€‚

#### éšæœºæ£®æ—

åœ¨éšæœºæ£®æ—ä¸­ï¼Œé›†åˆä¸­çš„æ¯æ£µæ ‘éƒ½æ˜¯æ ¹æ®ä»è®­ç»ƒé›†ä¸­æŠ½å–çš„æ ·æœ¬è¿›è¡Œæ›¿æ¢è€Œæ„å»ºçš„ã€‚æ­¤å¤–ï¼Œåœ¨æ„å»ºæ ‘çš„è¿‡ç¨‹ä¸­å¯¹æ¯ä¸ªèŠ‚ç‚¹è¿›è¡Œæ‹†åˆ†æ—¶ï¼Œå¯ä»¥ä»æ‰€æœ‰è¾“å…¥ç‰¹æ€§æˆ–max_featureså¤§å°çš„éšæœºå­é›†ä¸­æ‰¾åˆ°æœ€ä½³æ‹†åˆ†ã€‚

![](http://ww3.sinaimg.cn/bmiddle/006tNc79gy1g5jvp1k3wlj30lo0ehjuv.jpg)

è¿™ä¸¤ä¸ªéšæœºæ€§æ¥æºçš„ç›®çš„æ˜¯é™ä½æ£®æ—ä¼°è®¡é‡çš„æ–¹å·®ã€‚å•ä¸ªå†³ç­–æ ‘é€šå¸¸è¡¨ç°å‡ºå¾ˆé«˜çš„æ–¹å·®ï¼Œå¹¶ä¸”å€¾å‘äºè¿‡åº¦æ‹Ÿåˆã€‚æ£®æ—ä¸­æ³¨å…¥çš„éšæœºæ€§äº§ç”Ÿäº†å…·æœ‰ä¸€å®šè§£è€¦é¢„æµ‹è¯¯å·®çš„å†³ç­–æ ‘ã€‚é€šè¿‡å¯¹è¿™äº›é¢„æµ‹å–å¹³å‡å€¼ï¼Œä¸€äº›é”™è¯¯å¯ä»¥æŠµæ¶ˆã€‚éšæœºæ£®æ—é€šè¿‡ç»„åˆä¸åŒçš„æ ‘æœ¨æ¥å‡å°‘æ–¹å·®ï¼Œæœ‰æ—¶ä»¥ç•¥å¾®å¢åŠ åå·®ä¸ºä»£ä»·ã€‚

![](http://ww4.sinaimg.cn/bmiddle/006tNc79gy1g5jvs0c751j30gg0ccadl.jpg)

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å…ˆå®šä¹‰å¥½ä¸€ä¸ªéšå³æ£®æ—ğŸŒ²å›å½’å™¨ï¼Œç„¶åç”¨é»„è½¬å¤´ğŸ§±å¯è§†åŒ–å¹¶è¯„åˆ†ï¼Œæœ€åç”¨æ•£ç‚¹å›¾å±•ç¤ºäº†419ä¸ªæœ‰æ•ˆæ•°æ®ä¸­çƒå‘˜çœŸå®å·¥èµ„ä¸é¢„æµ‹è–ªæ°´ä¹‹é—´çš„å·®è·ã€‚


```python
# Instantiate the model and visualizer
rfr = RandomForestRegressor()
visualizer = PredictionError(rfr)
visualizer.fit(X_train, y_train)  # Fit the training data to the visualizer
visualizer.score(X_test, y_test)  # Evaluate the model on the test data
g = visualizer.poof()             # Draw/show/poof the data

# Prediction plot
predictions = rfr.predict(X)
prd_rfr = predictions.astype(int)
plt.figure(figsize=(6,4))
x = range(len(prd_rfr))
plt.grid(ls=':', lw=1)
plt.scatter(x, prd_rfr, color='#FEB64D', marker='o', facecolor='None', lw=2)
plt.scatter(x, y, color='#9287E7', marker='o')
label = ["Prediction", "Actual"]
plt.legend(label, loc=2, markerscale=0.85, ncol = 1, fontsize=10, framealpha=1)

plt.title('Random Forest Regression', fontsize=12)
plt.savefig("./fig/reg/rfr.png")
plt.show()

# Show score
print("Model Score: ",rfr.score(X_test, y_test))
```



![](http://ww3.sinaimg.cn/large/006tNc79gy1g5k0bfcdpvj309u09zweu.jpg)

![](http://ww3.sinaimg.cn/large/006tNc79gy1g5k0bi41ftj30aa079q4e.jpg)


    Model Score:  0.5179059365052248


#### éå¸¸éšæœºæ ‘

åœ¨Extremely Randomized Treesä¸­ï¼Œéšæœºæ€§åœ¨åˆ†å‰²è®¡ç®—çš„æ–¹å¼ä¸Šæ›´è¿›ä¸€æ­¥ã€‚ä¸éšæœºæ£®æ—ä¸€æ ·ï¼Œä½¿ç”¨å€™é€‰ç‰¹å¾çš„éšæœºå­é›†ï¼Œä½†ä¸æ˜¯å¯»æ‰¾æœ€å…·é‰´åˆ«æ€§çš„é˜ˆå€¼ï¼Œè€Œæ˜¯ä¸ºæ¯ä¸ªå€™é€‰ç‰¹å¾éšæœºç»˜åˆ¶é˜ˆå€¼ï¼Œå¹¶é€‰å–è¿™äº›éšæœºç”Ÿæˆçš„é˜ˆå€¼ä¸­æœ€å¥½çš„ä½œä¸ºåˆ†å‰²è§„åˆ™ã€‚è¿™é€šå¸¸å…è®¸ç¨å¾®å‡å°‘æ¨¡å‹çš„æ–¹å·®ï¼Œä½†ä»£ä»·æ˜¯åç§»çš„ç¨å¾®å¢åŠ ã€‚

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å…ˆå®šä¹‰å¥½ä¸€ä¸ªExtra Treeså›å½’å™¨ï¼Œç„¶åç”¨é»„è½¬å¤´ğŸ§±å¯è§†åŒ–å¹¶è¯„åˆ†ï¼Œæœ€åç”¨æ•£ç‚¹å›¾å±•ç¤ºäº†419ä¸ªæœ‰æ•ˆæ•°æ®ä¸­çƒå‘˜çœŸå®å·¥èµ„ä¸é¢„æµ‹è–ªæ°´ä¹‹é—´çš„å·®è·ã€‚


```python
# Instantiate the model and visualizer
etr = ExtraTreesRegressor()
visualizer = PredictionError(etr)
visualizer.fit(X_train, y_train)  # Fit the training data to the visualizer
visualizer.score(X_test, y_test)  # Evaluate the model on the test data
g = visualizer.poof()             # Draw/show/poof the data

# Prediction plot
predictions = etr.predict(X)
prd_etr = predictions.astype(int)
plt.figure(figsize=(6,4))
plt.grid(ls='--', lw=2)
x = range(len(prd_etr))
plt.grid(ls=':', lw=1)
plt.scatter(x, prd_etr, color='#FEB64D', marker='o', facecolor='None', lw=2)
plt.scatter(x, y, color='#9287E7', marker='o')
label = ["Prediction", "Actual"]
plt.legend(label, loc=2, markerscale=0.85, ncol = 1, fontsize=10, framealpha=1)

plt.title('Extra Trees Regression', fontsize=12)
plt.savefig("./fig/reg/etr.png")
plt.show()

# Show score
print("Model Score: ",etr.score(X_test, y_test))
```



![](http://ww1.sinaimg.cn/large/006tNc79gy1g5k0bkvljvj309u09zjrq.jpg)

![](http://ww1.sinaimg.cn/large/006tNc79gy1g5k0boar69j30aa0790u1.jpg)


    Model Score:  0.5157097221777236


#### æ¢¯åº¦å¢å¼ºå›å½’æ ‘

æ¢¯åº¦å¢å¼ºå›å½’æ ‘æ˜¯å¯¹ä»»æ„å¯å¾®æŸå¤±å‡½æ•°è¿›è¡Œå¢å¼ºçš„æ¨å¹¿ã€‚æ¢¯åº¦å¢å¼ºå›å½’æ ‘æ˜¯ä¸€ç§ç²¾ç¡®æœ‰æ•ˆçš„ç°æˆç¨‹åºï¼Œå¯ç”¨äºå›å½’å’Œåˆ†ç±»é—®é¢˜ã€‚æ¢¯åº¦æ ‘å¢å¼ºæ¨¡å‹è¢«å¹¿æ³›åº”ç”¨äºç½‘ç»œæœç´¢æ’åå’Œç”Ÿæ€ç­‰é¢†åŸŸã€‚å…¶ä¼˜ç‚¹æ˜¯å¯ä»¥å¯¹æ··åˆç±»å‹æ•°æ®çš„è‡ªç„¶å¤„ç†ã€æœ‰è¾ƒå¥½çš„é¢„æµ‹èƒ½åŠ›ä»¥åŠå¤„ç†è¾“å‡ºç©ºé—´å¼‚å¸¸å€¼æ—¶çš„é²æ£’æ€§ã€‚

![](http://ww2.sinaimg.cn/bmiddle/006tNc79gy1g5jw9yrp99j30sy087jsa.jpg)

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å…ˆå®šä¹‰å¥½ä¸€ä¸ªæ¢¯åº¦å¢å¼ºæ ‘ğŸŒ²å›å½’å™¨ï¼Œç„¶åç”¨é»„è½¬å¤´ğŸ§±å¯è§†åŒ–å¹¶è¯„åˆ†ï¼Œæœ€åç”¨æ•£ç‚¹å›¾å±•ç¤ºäº†419ä¸ªæœ‰æ•ˆæ•°æ®ä¸­çƒå‘˜çœŸå®å·¥èµ„ä¸é¢„æµ‹è–ªæ°´ä¹‹é—´çš„å·®è·ã€‚


```python
# Instantiate the model and visualizer
gbr = GradientBoostingRegressor(n_estimators=100, max_depth=4,
                                    learning_rate=0.1, loss='huber',
                                    random_state=1)
visualizer = PredictionError(gbr)
visualizer.fit(X_train, y_train)  # Fit the training data to the visualizer
visualizer.score(X_test, y_test)  # Evaluate the model on the test data
g = visualizer.poof()             # Draw/show/poof the data

# Prediction plot
predictions = gbr.predict(X)
prd_gbr = predictions.astype(int)
plt.figure(figsize=(6,4))
x = range(len(prd_gbr))
plt.grid(ls=':', lw=1)
plt.scatter(x, prd_gbr, color='#FEB64D', marker='o', facecolor='None', lw=2)
plt.scatter(x, y, color='#9287E7', marker='o')
label = ["Prediction", "Actual"]
plt.legend(label, loc=2, markerscale=0.85, ncol = 1, fontsize=10, framealpha=1)

plt.title('Gradient Boosting Regression', fontsize=12)
plt.savefig("./fig/reg/gbr.png")
plt.show()

# Show score
print("Model Score: ",gbr.score(X_test, y_test))
```


![](http://ww3.sinaimg.cn/large/006tNc79gy1g5k0btwen6j309u09z74n.jpg)



![](http://ww1.sinaimg.cn/large/006tNc79gy1g5k0bwbtyej30aa079jss.jpg)


    Model Score:  0.5696922511542333

---

## æ–¹æ³•è¯„ä¼°

ç”¨äº†è¿™ä¹ˆä¸€å¤§å †å›å½’æ¨¡å‹å’Œæ–¹æ³•ï¼Œç©¶ç«Ÿé‚£ä¸ªæ›´é€‚åˆæˆ‘ä»¬è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ

![](http://ww1.sinaimg.cn/bmiddle/006tNc79gy1g5jx8zy9epj30k009ydhd.jpg)

æˆ‘ä»¬ç”¨`sklearn.metrics`ä¸­çš„å„ç§æŒ‡æ ‡è¯„ä¼°äº†ä¸€ä¸‹æ¯ç§æ¨¡å‹çš„è¡¨ç°ã€‚æˆ‘ä»¬å‘ç°ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œ**éå¸¸éšæœºå›å½’æ ‘å’Œæ¢¯åº¦å¢å¼ºå›å½’æ ‘ğŸŒ²è¡¨ç°æœ€å¥½â€”â€”åœ¨è·å¾—æœ€é«˜â€œR\_2 Scoreâ€çš„åŒæ—¶æ‹¥æœ‰â€œæœ€å°çš„è¯¯å·®â€**ã€‚

### åº¦é‡æ ‡å‡†

é¦–å…ˆæˆ‘ä»¬åœ¨è¿™é‡Œç¡®å®šå¥½æˆ‘ä»¬çš„åº¦é‡æ ‡å‡†ã€‚Luckilyï¼Œ`sklearn`ä¸ºæˆ‘ä»¬æä¾›äº†å¾ˆå¤šå¸¸ç”¨çš„åº¦é‡å›å½’æ ‡å‡†ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œç”¨äº†å‡ ä¸ªæ¯”è¾ƒå¸¸ç”¨çš„metricsä½œdemoã€‚

![](http://ww4.sinaimg.cn/bmiddle/006tNc79gy1g5jxcjbezvj31090u04a5.jpg)


```python
from sklearn.metrics import r2_score
from sklearn.metrics import mean_squared_error
from sklearn.metrics import mean_absolute_error
from sklearn.metrics import explained_variance_score
```

### è¯„ä¼°

#### R2 å¾—åˆ†

`r2_score`å‡½æ•°è®¡ç®—å†³å®šç³»æ•°ï¼Œé€šå¸¸è¡¨ç¤ºä¸º$R^2$ã€‚å®ƒè¡¨ç¤ºæ¨¡å‹ä¸­è‡ªå˜é‡è§£é‡Šçš„æ–¹å·®çš„æ¯”ä¾‹ï¼Œæä¾›äº†æ‹Ÿåˆä¼˜åº¦çš„æŒ‡æ ‡ï¼Œå¯ä»¥è¡¡é‡æ¨¡å‹é¢„æµ‹ä¸å¯è§æ ·æœ¬çš„å¯èƒ½æ€§ã€‚å› æ­¤æ–¹å·®æ•°æ®é›†ç›¸å…³ï¼Œ$R^2$å¯èƒ½ä¸æ˜¯æœ‰æ„ä¹‰çš„æ¯”è¾ƒåœ¨ä¸åŒçš„æ•°æ®é›†ã€‚æœ€å¥½çš„åˆ†æ•°æ˜¯1.0ï¼Œä¹Ÿå¯ä»¥æ˜¯è´Ÿæ•°ã€‚å¦‚æœä¸€ä¸ªå¸¸æ•°æ¨¡å‹æ€»æ˜¯é¢„æµ‹çš„æœŸæœ›å€¼ï¼Œæ— è§†è¾“å…¥åŠŸèƒ½ï¼Œä¼šå¾—åˆ°ä¸€ä¸ª$R^2=0$ã€‚`r2_score`å…·ä½“è®¡ç®—å…¬å¼æ˜¯ï¼š

$$R^2(y,\hat{y})=1-\frac{\sum_{i=1}^n (y_i-\hat{y_i})^2}{\sum_{i=1}^n (y_i-\overline{y})^2}.$$

æˆ‘ä»¬å…ˆå°†æ‰€æœ‰çš„æ¨¡å‹è¿›è¡Œè¯„ä¼°ï¼Œæ”¾åˆ°ä¸€ä¸ªlist `metric_r2_score`ä¸­ï¼Œç„¶åç”»å‡ºæŸ±å½¢å›¾æ¥è§‚å¯Ÿæ¯ç§æ¨¡å‹çš„`r2_score`ã€‚



```python
metric_r2_score = []
metric_r2_score.append(r2_score(y, prd_lr))
metric_r2_score.append(r2_score(y, prd_lasso))
metric_r2_score.append(r2_score(y, prd_ridge))
metric_r2_score.append(r2_score(y, prd_ridgeCV))
metric_r2_score.append(r2_score(y, prd_svr))
metric_r2_score.append(r2_score(y, prd_decision_tree))
metric_r2_score.append(r2_score(y, prd_knn))
metric_r2_score.append(r2_score(y, prd_rfr))
metric_r2_score.append(r2_score(y, prd_etr))
metric_r2_score.append(r2_score(y, prd_gbr))
metric_r2_score.append(r2_score(y, prd_enet))
```


```python
x_ax = range(len(metric_r2_score))
plt.figure(figsize=(6,4))
plt.grid(ls=':', lw=2)
plt.title('Evaluation')
plt.xlabel('Regression')
plt.ylabel('R2_Score')
plt.xticks(x_ax, ('linear','lasso','ridge','ridgeCV','svr','dec-tree','knn','rfr','etr','gbr','enet'))
plt.bar(x_ax, metric_r2_score, hatch='o', \
        color=['#409cfc','#32d3eb','#5bc49f','#feb64d','#ff7c7c','#9287e7'], \
        edgecolor=None, alpha=.7, width=.6)
plt.savefig("./fig/evl/R2_scores.png")
plt.show()
```


![](http://ww4.sinaimg.cn/large/006tNc79gy1g5k0c2dk4wj30ao07n74t.jpg)


ç»è¿‡è§‚å¯Ÿæˆ‘ä»¬çœ‹åˆ°ï¼Œéå¸¸éšæœºå›å½’æ ‘æœ‰æœ€é«˜çš„`r2_score`ï¼Œè¯´æ˜æ¨¡å‹æœ‰æœ€å°çš„æ–¹å·®ã€é¢„ä¼°ç»“æœæœ€ç¨³å®šã€‚

#### å¹³å‡æ–¹å·®

`mean_squared_error`å‡½æ•°è®¡ç®—å‡æ–¹è¯¯å·®ï¼Œå³ä¸å¹³æ–¹è¯¯å·®æˆ–æŸå¤±çš„æœŸæœ›å€¼ç›¸å¯¹åº”çš„é£é™©åº¦é‡ã€‚è®¡ç®—å…¬å¼ä¸ºï¼š

$$MSE(y,\hat{y})=\frac{1}{n_{samples}}\sum_{i=0}^{n_{samples}-1}(y_i-\hat{y_i})^2.$$

æˆ‘ä»¬å…ˆå°†æ‰€æœ‰çš„æ¨¡å‹è¿›è¡Œè¯„ä¼°ï¼Œæ”¾åˆ°ä¸€ä¸ªlist `errors`ä¸­ï¼Œç„¶åç”»å‡ºæŸ±å½¢å›¾æ¥è§‚å¯Ÿæ¯ç§æ¨¡å‹çš„`mean_squared_error`ã€‚


```python
errors = []
errors.append(mean_squared_error(y, prd_lr))
errors.append(mean_squared_error(y, prd_lasso))
errors.append(mean_squared_error(y, prd_ridge))
errors.append(mean_squared_error(y, prd_ridgeCV))
errors.append(mean_squared_error(y, prd_svr))
errors.append(mean_squared_error(y, prd_decision_tree))
errors.append(mean_squared_error(y, prd_knn))
errors.append(mean_squared_error(y, prd_rfr))
errors.append(mean_squared_error(y, prd_etr))
errors.append(mean_squared_error(y, prd_gbr))
errors.append(mean_squared_error(y, prd_enet))
```


```python
x_ax = range(len(errors))
plt.figure(figsize=(6,4))
plt.grid(ls=':', lw=2)
plt.title('Evaluation')
plt.xlabel('Regression')
plt.ylabel('Mean Square Error')
plt.xticks(x_ax, ('linear','lasso','ridge','ridgeCV','svr','dec-tree','knn','rfr','etr','gbr','enet'))
plt.bar(x_ax, errors, hatch='*', \
        color=['#409cfc','#32d3eb','#5bc49f','#feb64d','#ff7c7c','#9287e7'], \
        edgecolor=None, alpha=.7, width=.6)
plt.savefig("./fig/evl/mean_squares.png")
plt.show()
```


![](http://ww2.sinaimg.cn/large/006tNc79gy1g5k0c7cfhuj30ao07n3zb.jpg)


ç»è¿‡è§‚å¯Ÿæˆ‘ä»¬çœ‹åˆ°ï¼Œéå¸¸éšæœºå›å½’æ ‘æœ‰æœ€å°çš„`mean_squared_error`ï¼Œè¯´æ˜æ¨¡å‹æœ‰æœ€å°çš„æ–¹å·®ã€é¢„ä¼°ç»“æœæœ€ç¨³å®šã€‚

#### å¹³å‡ç»å¯¹è¯¯å·®

`mean_absolute_error`å‡½æ•°è®¡ç®—å¹³å‡ç»å¯¹è¯¯å·®ï¼Œè¿™æ˜¯ä¸€ä¸ªé£é™©åº¦é‡ï¼Œå¯¹åº”äºç»å¯¹è¯¯å·®æŸå¤±æˆ–`l1-norm`æŸå¤±çš„æœŸæœ›å€¼ã€‚è®¡ç®—å…¬å¼ä¸ºï¼š

$$MAE(y,\hat{y})=\frac{1}{n_{samples}}\sum_{i=0}^{n_{samples}-1}|y_i-\hat{y_i}|.$$

æˆ‘ä»¬å…ˆå°†æ‰€æœ‰çš„æ¨¡å‹è¿›è¡Œè¯„ä¼°ï¼Œæ”¾åˆ°ä¸€ä¸ªlist `ab_errors`ä¸­ï¼Œç„¶åç”»å‡ºæŸ±å½¢å›¾æ¥è§‚å¯Ÿæ¯ç§æ¨¡å‹çš„`mean_absolute_error`ã€‚


```python
ab_errors = []
ab_errors.append(mean_absolute_error(y, prd_lr))
ab_errors.append(mean_absolute_error(y, prd_lasso))
ab_errors.append(mean_absolute_error(y, prd_ridge))
ab_errors.append(mean_absolute_error(y, prd_ridgeCV))
ab_errors.append(mean_absolute_error(y, prd_svr))
ab_errors.append(mean_absolute_error(y, prd_decision_tree))
ab_errors.append(mean_absolute_error(y, prd_knn))
ab_errors.append(mean_absolute_error(y, prd_rfr))
ab_errors.append(mean_absolute_error(y, prd_etr))
ab_errors.append(mean_absolute_error(y, prd_gbr))
ab_errors.append(mean_absolute_error(y, prd_enet))
```


```python
x_ax = range(len(ab_errors))
plt.figure(figsize=(6,4))
plt.grid(ls=':', lw=2)
plt.title('Evaluation')
plt.xlabel('Regression')
plt.ylabel('Mean Absolute Error')
plt.xticks(x_ax, ('linear','lasso','ridge','ridgeCV','svr','dec-tree','knn','rfr','etr','gbr','enet'))
plt.bar(x_ax, ab_errors, hatch='x', \
        color=['#409cfc','#32d3eb','#5bc49f','#feb64d','#ff7c7c','#9287e7'], \
        edgecolor=None, alpha=.7, width=.6)
plt.savefig("./fig/evl/absolute_squares.png")
plt.show()
```


![](http://ww3.sinaimg.cn/large/006tNc79gy1g5k0caoq19j30bc07ndgk.jpg)


ç»è¿‡è§‚å¯Ÿæˆ‘ä»¬çœ‹åˆ°ï¼Œéå¸¸éšæœºå›å½’æ ‘æœ‰æœ€å°çš„`mean_absolute_error`ï¼Œè¯´æ˜æ¨¡å‹æœ‰æœ€å°çš„ç»å¯¹è¯¯å·®ã€é¢„ä¼°ç»“æœæœ€ç¨³å®šã€‚

#### è§£é‡Šæ–¹å·®çš„åˆ†æ•°

è§£é‡Šå˜é‡åº¦é‡æ•°å­¦æ¨¡å‹å¯¹ç»™å®šæ•°æ®é›†çš„å˜åŒ–æ‰€å çš„æ¯”ä¾‹ï¼Œè®¡ç®—å…¬å¼ä¸ºï¼š

$$EXV(y,\hat{y})=1-\frac{Var\{y-\hat{y}\}}{Var\{y\}}.$$

æˆ‘ä»¬å…ˆå°†æ‰€æœ‰çš„æ¨¡å‹è¿›è¡Œè¯„ä¼°ï¼Œæ”¾åˆ°ä¸€ä¸ªlist `explained_vars`ä¸­ï¼Œç„¶åç”»å‡ºæŸ±å½¢å›¾æ¥è§‚å¯Ÿæ¯ç§æ¨¡å‹çš„`explained_variance_score`ã€‚


```python
explained_vars = []
explained_vars.append(explained_variance_score(y, prd_lr))
explained_vars.append(explained_variance_score(y, prd_lasso))
explained_vars.append(explained_variance_score(y, prd_ridge))
explained_vars.append(explained_variance_score(y, prd_ridgeCV))
explained_vars.append(explained_variance_score(y, prd_svr))
explained_vars.append(explained_variance_score(y, prd_decision_tree))
explained_vars.append(explained_variance_score(y, prd_knn))
explained_vars.append(explained_variance_score(y, prd_rfr))
explained_vars.append(explained_variance_score(y, prd_etr))
explained_vars.append(explained_variance_score(y, prd_gbr))
explained_vars.append(explained_variance_score(y, prd_enet))
```


```python
x_ax = range(len(explained_vars))
plt.figure(figsize=(6,4))
plt.grid(ls=':', lw=2)
plt.title('Evaluation')
plt.xlabel('Regression')
plt.ylabel('Explained Variance Score')
plt.xticks(x_ax, ('linear','lasso','ridge','ridgeCV','svr','dec-tree','knn','rfr','etr','gbr','enet'))
plt.bar(x_ax, explained_vars, hatch='.', \
        color=['#409cfc','#32d3eb','#5bc49f','#feb64d','#ff7c7c','#9287e7'], \
        edgecolor=None, alpha=.7, width=.6)
plt.savefig("./fig/evl/ev_scores.png")
plt.show()
```


![](http://ww1.sinaimg.cn/large/006tNc79gy1g5k0ce4monj30ao07n0t5.jpg)


ç»è¿‡è§‚å¯Ÿæˆ‘ä»¬çœ‹åˆ°ï¼Œéå¸¸éšæœºå›å½’æ ‘æœ‰æœ€å°çš„`explained_variance_score`ï¼Œè¯´æ˜æ¨¡å‹æœ‰æœ€å°çš„ç»å¯¹è¯¯å·®ã€é¢„ä¼°ç»“æœæœ€ç¨³å®šã€‚

---

## ç»“è®ºä¸å±•æœ›

æˆ‘ä»¬åœ¨è¿™ä¸ªå®éªŒä¸­ç”¨å¾®è½¯çš„**Azureäº‘â˜ï¸æœºå™¨å­¦ä¹ å¹³å°**å·¥å…·å¯¹NBAçƒå‘˜çš„èƒ½åŠ›è¿›è¡Œè¯„ä¼°ï¼Œå¹¶å¯¹ä»–ä»¬çš„è–ªæ°´è¿›è¡Œé¢„æµ‹ã€‚æˆ‘ä»¬é‡‡ç”¨äº†`sklearn`è½®å­ä¸­çš„å¤šç§å›å½’æ¨¡å‹ï¼Œé¢„æµ‹å‡ºçš„ç»“æœä¹Ÿæœ‰ä¸€å®šå¯ä¿¡æ€§ã€‚

![](http://ww3.sinaimg.cn/bmiddle/006tNc79gy1g5jz0x92blj30ei0aqwf9.jpg)

**ä½†æ˜¯ï¼ä½†æ˜¯ï¼ä½†æ˜¯ï¼**

æˆ‘ä»¬è¿˜æ˜¯ä¸èƒ½å°†è¿™äº›å›å½’ç”¨äºå·¥ä¸šç”¨é€”ï¼Œå› ä¸ºä¸çœŸå®ä¸–ç•Œç›¸æ¯”ï¼Œè¿™äº›æ¨¡å‹è¿˜æ˜¯æœ‰å¤±å…¬å…ã€‚è¯¯å·®çš„æ¥æºå¯èƒ½è¿˜ä¼šæ¥è‡ªä»¥ä¸‹æ–¹é¢ã€‚

æœ‰æ—¶å€™ï¼Œæ•°æ®å¹¶ä¸åŒ¹é…èƒ½åŠ›ï¼Œå¾ˆå¤šçƒå‘˜çš„ä»·å€¼æ— æ³•ä»…ä»…ç”¨æ•°æ®æ¥è¡¡é‡ï¼ˆ*å½“ç„¶äº†ï¼Œè–ªèµ„å’Œèƒ½åŠ›æœ‰æ—¶å€™ä¹Ÿä¸æˆæ­£ç›¸å…³*ï¼‰ã€‚æœ‰äº›çƒæ˜Ÿå¸¸è§„èµ›åˆ’æ°´ï¼Œä¸ºäº†ä¿æŒå……æ²›ä½“èƒ½ä¸åœè½®ä¼‘ï¼Œåˆ°äº†å­£åèµ›ï¼Œå€’æ˜¯æ€å¼€æ£ºææ¿ï¼›æœ‰äº›å¸¸è§„èµ›å·¨æ˜Ÿåˆ°äº†å­£åèµ›å°±èé¡ä¸æŒ¯ï¼Œå¸¸å¹´ä¸€è½®äºŒè½®æ¸¸ğŸ£ã€‚

![](http://ww2.sinaimg.cn/bmiddle/006tNc79gy1g5jztae4q8j30ti0de76i.jpg)

æ•°æ®çš„æˆè‰²ä¹Ÿä¸å°½ç›¸åŒï¼Œæœ‰äº›çƒé˜Ÿæ‹¥æœ‰å¤šä¸ªçƒæ˜Ÿï¼Œä»–ä»¬çš„å‘æŒ¥å¯èƒ½å—åˆ°çƒæƒé™åˆ¶ã€‚å¯¹äºè¿™äº›çƒå‘˜ï¼Œå³ä½¿æ•°æ®ç¼©æ°´ï¼Œä»–ä»¬åœ¨è‡ªç”±å¸‚åœºä¸­ä¾ç„¶è¿˜æ˜¯é¦™é¥½é¥½ï¼Œå¾ˆæœ‰å¯èƒ½æ‹¿åˆ°å¤§åˆåŒã€‚

![](http://ww3.sinaimg.cn/bmiddle/006tNc79gy1g5jzr2mdo0j30eu08ct96.jpg)

é™¤æ­¤ä¹‹å¤–ï¼ŒNBAè”ç›Ÿä¸­çš„è´«å¯Œå·®è·è¿˜æ˜¯è›®å¤§çš„ï¼Œå¾ˆå¤šè¶…çº§å·¨æ˜Ÿå¯Œå¯æ•Œå›½ï¼Œæœ‰äº›è§’è‰²çƒå‘˜è¿˜åœ¨æ‘¸æ‰“æ»šçˆ¬ã€‚æˆ‘ä»¬çš„é¢„æµ‹æ¨¡å‹åœ¨é¢„æµ‹æç«¯æƒ…å†µæ—¶ï¼Œæ¯”è¾ƒä¿å®ˆã€‚ä¹Ÿä¸éš¾ç†è§£ï¼Œæœ‰æ—¶å€™ï¼Œå¾—åˆ°ä¸€ä¸ªé¡¶çº§å·¨æ˜Ÿçš„ä»·å€¼æ˜¯æ— ä¸ä¼¦æ¯”çš„ï¼Œè¿™ç§çƒæ˜Ÿçš„ä»·å€¼å¯¹çƒé˜Ÿç°åœ¨ç”šè‡³å†å²è€Œè¨€éƒ½æ˜¯ä¸å¯ä¼°é‡çš„ã€‚

![](http://ww1.sinaimg.cn/bmiddle/006tNc79gy1g5jzw02vmcj30xw0egwgy.jpg)

å¦å¤–ï¼Œéšç€å·¥èµ„å¸½æ°´æ¶¨èˆ¹é«˜ï¼Œçƒå‘˜éƒ½â€œå…±åŒå¯Œè£•äº†â€ï¼Œç”šè‡³åœ¨åŒä¸€ä¸ªèµ›å­£éƒ½èƒ½çœ‹è§æ˜æ˜¾æ¶¨å¹…ã€‚å› æ­¤æˆ‘ä»¬çš„æ¨¡å‹çš„é¢„æµ‹å€¼å¤§éƒ¨åˆ†æ²¡æœ‰è¾¾åˆ°çƒå‘˜çœŸå®è–ªæ°´ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå¥½çš„è–ªæ°´ç¦»ä¸å¼€ç»çºªäººçš„åŠªåŠ›ã€‚å¯¹äºä¸€äº›æ•°æ®å¹¶ä¸æ˜¾çœ¼çš„çƒå‘˜ï¼Œå¾ˆå¤šå¤§ç‰Œç»çºªäººå¾€å¾€èƒ½å¸¦æ¥æ›´å¤šçº¢åˆ©ã€‚

![](http://ww2.sinaimg.cn/bmiddle/006tNc79gy1g5jzjxoojoj30zk0k0q69.jpg)

çƒå‘˜å·¥èµ„ä¸ä»…ä»…å–å†³äºåœºä¸Šè¡¨ç°ï¼Œè¿˜è·Ÿçƒå‘˜å½±å“åŠ›æœ‰å…³ã€‚å½±å“åŠ›å·¨å¤§çš„çƒæ˜Ÿï¼Œå°±ç®—æ˜¯æ•°æ®è¡¨ç°ä¸å¥½ï¼Œè¿˜æ˜¯èƒ½æ‹¿å¾—åˆ°å¤§åˆåŒï¼Œå› æ­¤ä»…ä»…æ¨ªå‘è€ƒè™‘æ•°æ®å› ç´ æ˜¯è¿œè¿œä¸å¤Ÿçš„ã€‚æ•°æ®é›†å­˜åœ¨çš„å¤©ç„¶ç¼ºé™·å†³å®šäº†æˆ‘ä»¬çš„æ–¹æ³•ä¹Ÿä¸èƒ½æ™®é€‚äºå„ç§æƒ…å†µã€‚

![](http://ww3.sinaimg.cn/bmiddle/006tNc79gy1g5jzkxgx4vj30ev08cjrr.jpg)

å¦å¤–ï¼ŒNBAè¿˜å‡ºå°äº†å¾ˆå¤šrulesï¼Œæ¯”å¦‚ä¼¯å¾·æ¡æ¬¾ã€ç½—æ–¯æ¡æ¬¾ç­‰ç­‰ï¼Œå·¥èµ„è¿˜ä¼šå—åˆ°å„ç§æ¡çº¦é™åˆ¶ã€‚NBAçš„è–ªèµ„è§„åˆ™æ˜¯ååˆ†å¤æ‚çš„ï¼Œå› æ­¤ï¼Œå°±ç®—èƒ½åŠ›å†å¼ºã€æ•°æ®å†å¥½ï¼Œä¹Ÿå¾—éµå¾ªç‰¹å®šçš„å·¥èµ„è§„åˆ™ã€‚ä»…ä»…é å›å½’æ¨¡å‹è¿›è¡Œé¢„æµ‹å®šç„¶æ˜¯ä¸çœŸå®æƒ…å†µç›¸å»ç”šè¿œçš„äº†ã€‚

![](http://ww2.sinaimg.cn/bmiddle/006tNc79gy1g5k02rh9yuj30hi0boq3i.jpg)

---
